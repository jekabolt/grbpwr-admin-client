import{j as e}from"./mui-uYomrlsc.js";import{T as i,C as _,c as y,x as W,y as oe,R as ce,z as le,A as ie,D as z,P as Y,E as T,G as q,H as G,J as de,K as ue,N as pe,O as fe,Q as xe,S as me,V as he,W as ge,X as ve,Y as Q,B as S,Z as je,a as $,$ as Ne,d as Pe,a0 as be,a1 as Ce,p as we,b as M,a2 as Ie,a3 as Ee,a4 as Se}from"./index-UWfNKM0D.js";import{S as F}from"./filter-B8x8g7tl.js";import{r as x,d as Oe}from"./vendor-DljJgkTU.js";function Ae({buyer:r,isPrinting:t}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(i,{variant:"uppercase",className:"font-bold",children:"buyer information:"}),e.jsx(i,{className:"flex items-center gap-2",variant:"uppercase",children:["email: ",e.jsx(i,{component:"span",className:"lowercase select-all",children:e.jsx(_,{text:(r==null?void 0:r.email)||""})})]}),e.jsxs(i,{variant:"uppercase",children:["first name: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.firstName})]}),e.jsxs(i,{variant:"uppercase",children:["last name: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.lastName})]}),e.jsxs(i,{variant:"uppercase",children:["phone: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.phone})]}),e.jsx(i,{variant:"uppercase",className:y({hidden:t}),children:["receive promo emails: ",r!=null&&r.receivePromoEmails?e.jsx(i,{component:"span",className:F.confirmed,children:"yes"}):e.jsx(i,{component:"span",className:F.denied,children:"no"})]})]})}var L="Popover",[K]=le(L,[W]),k=W(),[ye,A]=K(L),V=r=>{const{__scopePopover:t,children:s,open:n,defaultOpen:a,onOpenChange:o,modal:u=!1}=r,d=k(t),m=x.useRef(null),[g,c]=x.useState(!1),[l,f]=oe({prop:n,defaultProp:a??!1,onChange:o,caller:L});return e.jsx(ce,{...d,children:e.jsx(ye,{scope:t,contentId:ie(),triggerRef:m,open:l,onOpenChange:f,onOpenToggle:x.useCallback(()=>f(v=>!v),[f]),hasCustomAnchor:g,onCustomAnchorAdd:x.useCallback(()=>c(!0),[]),onCustomAnchorRemove:x.useCallback(()=>c(!1),[]),modal:u,children:s})})};V.displayName=L;var Z="PopoverAnchor",Re=x.forwardRef((r,t)=>{const{__scopePopover:s,...n}=r,a=A(Z,s),o=k(s),{onCustomAnchorAdd:u,onCustomAnchorRemove:d}=a;return x.useEffect(()=>(u(),()=>d()),[u,d]),e.jsx(q,{...o,...n,ref:t})});Re.displayName=Z;var J="PopoverTrigger",X=x.forwardRef((r,t)=>{const{__scopePopover:s,...n}=r,a=A(J,s),o=k(s),u=z(t,a.triggerRef),d=e.jsx(Y.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":ne(a.open),...n,ref:u,onClick:T(r.onClick,a.onOpenToggle)});return a.hasCustomAnchor?d:e.jsx(q,{asChild:!0,...o,children:d})});X.displayName=J;var H="PopoverPortal",[_e,Te]=K(H,{forceMount:void 0}),D=r=>{const{__scopePopover:t,forceMount:s,children:n,container:a}=r,o=A(H,t);return e.jsx(_e,{scope:t,forceMount:s,children:e.jsx(G,{present:s||o.open,children:e.jsx(de,{asChild:!0,container:a,children:n})})})};D.displayName=H;var R="PopoverContent",ee=x.forwardRef((r,t)=>{const s=Te(R,r.__scopePopover),{forceMount:n=s.forceMount,...a}=r,o=A(R,r.__scopePopover);return e.jsx(G,{present:n||o.open,children:o.modal?e.jsx(Me,{...a,ref:t}):e.jsx(Fe,{...a,ref:t})})});ee.displayName=R;var ke=fe("PopoverContent.RemoveScroll"),Me=x.forwardRef((r,t)=>{const s=A(R,r.__scopePopover),n=x.useRef(null),a=z(t,n),o=x.useRef(!1);return x.useEffect(()=>{const u=n.current;if(u)return ue(u)},[]),e.jsx(pe,{as:ke,allowPinchZoom:!0,children:e.jsx(re,{...r,ref:a,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:T(r.onCloseAutoFocus,u=>{var d;u.preventDefault(),o.current||(d=s.triggerRef.current)==null||d.focus()}),onPointerDownOutside:T(r.onPointerDownOutside,u=>{const d=u.detail.originalEvent,m=d.button===0&&d.ctrlKey===!0,g=d.button===2||m;o.current=g},{checkForDefaultPrevented:!1}),onFocusOutside:T(r.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1})})})}),Fe=x.forwardRef((r,t)=>{const s=A(R,r.__scopePopover),n=x.useRef(!1),a=x.useRef(!1);return e.jsx(re,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var u,d;(u=r.onCloseAutoFocus)==null||u.call(r,o),o.defaultPrevented||(n.current||(d=s.triggerRef.current)==null||d.focus(),o.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:o=>{var m,g;(m=r.onInteractOutside)==null||m.call(r,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const u=o.target;((g=s.triggerRef.current)==null?void 0:g.contains(u))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&a.current&&o.preventDefault()}})}),re=x.forwardRef((r,t)=>{const{__scopePopover:s,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:o,disableOutsidePointerEvents:u,onEscapeKeyDown:d,onPointerDownOutside:m,onFocusOutside:g,onInteractOutside:c,...l}=r,f=A(R,s),v=k(s);return xe(),e.jsx(me,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:o,children:e.jsx(he,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:c,onEscapeKeyDown:d,onPointerDownOutside:m,onFocusOutside:g,onDismiss:()=>f.onOpenChange(!1),children:e.jsx(ge,{"data-state":ne(f.open),role:"dialog",id:f.contentId,...v,...l,ref:t,style:{...l.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),se="PopoverClose",te=x.forwardRef((r,t)=>{const{__scopePopover:s,...n}=r,a=A(se,s);return e.jsx(Y.button,{type:"button",...n,ref:t,onClick:T(r.onClick,()=>a.onOpenChange(!1))})});te.displayName=se;var Le="PopoverArrow",Ue=x.forwardRef((r,t)=>{const{__scopePopover:s,...n}=r,a=k(s);return e.jsx(ve,{...a,...n,ref:t})});Ue.displayName=Le;function ne(r){return r?"open":"closed"}var $e=V,He=X,Be=D,We=ee,ze=te;function Ye({openElement:r,title:t,children:s,contentProps:n,className:a,gap:o="default",variant:u="default"}){const[d,m]=x.useState(!1);return e.jsxs($e,{open:d,onOpenChange:m,children:[e.jsx(He,{className:"flex items-center",children:typeof r=="function"?r(d):r}),e.jsx(qe,{className:a,title:t,gap:o,variant:u,...n,children:s})]})}function qe({children:r,title:t,className:s,gap:n="default",variant:a="default",...o}){return e.jsx(Be,{children:e.jsxs(We,{side:"bottom",align:"center",className:y("relative z-20 w-full space-y-10 border border-textInactiveColor bg-bgColor px-2.5",{"space-y-16":n==="large","border-none":a==="no-borders"},s),...o,children:[t&&e.jsx(ze,{className:y("fixed left-2 right-2 top-2.5 bg-bgColor","appearance-none border-0 outline-none focus:outline-none"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{variant:"uppercase",children:t}),e.jsx(i,{children:"[x]"})]})}),e.jsx("div",{className:"relative max-h-[50vh] overflow-y-scroll",children:e.jsx("div",{className:"sticky top-0",children:r})})]})})}function Ge({orderDetails:r}){var t;return e.jsx(Ye,{variant:"default",contentProps:{align:"start",sideOffset:10},className:"p-5 bg-bgColor text-textColor",openElement:()=>e.jsx(S,{className:"border border-textInactiveColor rounded px-1 cursor-pointer",children:"i"}),children:e.jsx("div",{className:"flex flex-col gap-y-2",children:(t=r==null?void 0:r.statusHistory)==null?void 0:t.map(s=>{var n,a;return e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsxs(i,{children:[(a=(n=s.status)==null?void 0:n.replace("ORDER_STATUS_ENUM_",""))==null?void 0:a.replace("_"," "),": "]}),e.jsx(i,{children:Q(s.changedAt,!0)})]},s.id)})})})}function Qe({orderDetails:r,orderStatus:t,isPrinting:s}){var o,u,d;const n=je(t),a=Q((o=r==null?void 0:r.order)==null?void 0:o.placed,!0);return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[e.jsx(i,{variant:"uppercase",className:y("block",{"print:hidden":s}),children:`order id: ${(u=r==null?void 0:r.order)==null?void 0:u.id}`}),e.jsxs(i,{variant:"uppercase",children:["order reference: ",e.jsx("span",{className:"select-all",children:(d=r==null?void 0:r.order)==null?void 0:d.uuid})]}),e.jsxs("div",{className:"flex items-center gap-2 print:hidden",children:[e.jsx(i,{variant:"uppercase",children:"status:"}),e.jsx(i,{variant:"uppercase",className:y(n),children:t}),e.jsx(Ge,{orderDetails:r})]}),e.jsx(i,{variant:"uppercase",children:`placed: ${a}`})]})}const U="hidden lg:table-cell";function Ke({orderDetails:r,isPrinting:t=!1,showRefundSelection:s=!1,selectedOrderItemIds:n=[],onToggleOrderItems:a}){var g;const{dictionary:o}=$(),u=x.useMemo(()=>[{label:"THUMBNAIL",showOnPrint:!0,accessor:c=>{var l;return e.jsx("a",{href:`${Ne}/products/${(l=c.orderItem)==null?void 0:l.productId}`,target:"_blank",rel:"noopener noreferrer",className:"cursor-pointer flex items-center justify-center w-24 h-full mx-auto",children:e.jsx(Pe,{src:c.thumbnail||"",alt:"thumbnail",aspectRatio:"1/1",fit:"contain"})})}},{label:"SKU",showOnPrint:!0,className:U,accessor:c=>c.sku},{label:"PRODUCT NAME",showOnPrint:!0,accessor:c=>{var l;return(l=c.translations)==null?void 0:l[0].name}},{label:"QTY",showOnPrint:!1,accessor:c=>{var l;return c.aggregatedQuantity??((l=c.orderItem)==null?void 0:l.quantity)}},{label:"SIZE",showOnPrint:!1,accessor:c=>{var l,f,v;return(v=(f=(l=o==null?void 0:o.sizes)==null?void 0:l.find(P=>{var N;return P.id===((N=c.orderItem)==null?void 0:N.sizeId)}))==null?void 0:f.name)==null?void 0:v.replace("SIZE_ENUM_","")}},{label:"PRICE",showOnPrint:!1,className:U,accessor:c=>{var l,f;return`${c.aggregatedBasePrice??(c.productPrice&&((l=c.orderItem)!=null&&l.quantity)?c.productPrice*c.orderItem.quantity:0)} ${((f=r==null?void 0:r.order)==null?void 0:f.currency)||""}`}},{label:"SALE",showOnPrint:!1,className:U,accessor:c=>c.productSalePercentage},{label:"PRICE WITH SALE",showOnPrint:!0,accessor:c=>{var l;return`${c.aggregatedPriceWithSale??c.productPriceWithSale} ${((l=r==null?void 0:r.order)==null?void 0:l.currency)||""}`}}],[o,(g=r==null?void 0:r.order)==null?void 0:g.currency]),d=x.useMemo(()=>t?u.filter(c=>c.showOnPrint):u,[u,t]),m=x.useMemo(()=>{if(!(r!=null&&r.orderItems))return[];const c=new Map;return r.orderItems.forEach(l=>{var O,p,j,b;const f=((O=l.orderItem)==null?void 0:O.productId)??l.sku??`${l.thumbnail}-${((j=(p=l.translations)==null?void 0:p[0])==null?void 0:j.name)??""}`,v=c.get(f),P=Number(((b=l.orderItem)==null?void 0:b.quantity)??0),C=Number(l.productPrice??0)*P,I=Number(l.productPriceWithSale??0),w=typeof l.id=="number"?l.id:void 0;if(v){const h=v;h.aggregatedQuantity=Number(h.aggregatedQuantity??0)+P,h.aggregatedBasePrice=Number(h.aggregatedBasePrice??0)+C,h.aggregatedPriceWithSale=Number(h.aggregatedPriceWithSale??0)+I,w&&(h.orderItemIds=Array.isArray(h.orderItemIds)?[...h.orderItemIds,w]:[w])}else{const h={...l};h.aggregatedQuantity=P,h.aggregatedBasePrice=C,h.aggregatedPriceWithSale=I,h.orderItemIds=w?[w]:[],c.set(f,h)}}),Array.from(c.values())},[r==null?void 0:r.orderItems]);return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full border-collapse border-2 border-textColor min-w-max",children:[e.jsx("thead",{className:"bg-textInactiveColor h-10",children:e.jsxs("tr",{className:"border-b border-textColor",children:[s&&!t&&e.jsx("th",{className:"text-center w-10 border border-r border-textColor px-2",children:e.jsx(i,{variant:"uppercase",className:"leading-none",children:"refund"})}),d.map(c=>e.jsx("th",{className:`text-center w-auto lg:min-w-26 border border-r border-textColor px-2 ${c.className||""}`,children:e.jsx(i,{variant:"uppercase",className:"leading-none",children:c.label})},c.label))]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:d.length,className:"text-center py-8",children:e.jsx(i,{variant:"uppercase",children:"no items found"})})}):m.map((c,l)=>{const f=Array.isArray(c.orderItemIds)?c.orderItemIds:[],v=f.length>0&&f.every(N=>n.includes(N)),P=()=>{!f.length||!a||a(f)};return e.jsxs("tr",{className:"border-b border-text last:border-b-0 lg:w-24 ",children:[s&&!t&&e.jsx("td",{className:"border border-textColor text-center px-2 w-10",children:e.jsx("input",{type:"checkbox",checked:v,onChange:P,className:"cursor-pointer"})}),d.map(N=>e.jsx("td",{className:`border border-textColor text-center px-2 w-16  lg:w-auto ${N.className||""}`,children:N.label==="THUMBNAIL"?N.accessor(c):e.jsx(i,{children:N.accessor(c)})},N.label))]},l)})})]})})})}function Ve({orderDetails:r,isPrinting:t}){var n,a,o,u,d,m,g,c,l,f,v,P,N,C,I,w,O,p;const s=r==null?void 0:r.payment;return e.jsxs("div",{className:y("flex flex-col gap-1",{hidden:t}),children:[e.jsx(i,{variant:"uppercase",className:"font-bold",children:"payment:"}),e.jsxs(i,{variant:"uppercase",children:["status:"," ",(n=s==null?void 0:s.paymentInsert)!=null&&n.isTransactionDone?e.jsx(i,{component:"span",className:F.confirmed,children:"paid"}):e.jsx(i,{component:"span",className:F.denied,children:"unpaid"})]}),e.jsxs(i,{variant:"uppercase",children:["made at: ",be(s==null?void 0:s.modifiedAt)]}),e.jsxs(i,{variant:"uppercase",children:["payment method:"," ",(o=(a=s==null?void 0:s.paymentInsert)==null?void 0:a.paymentMethod)==null?void 0:o.replace("PAYMENT_METHOD_NAME_ENUM_","")]}),e.jsx(i,{variant:"uppercase",children:["amount: ",((u=s==null?void 0:s.paymentInsert)==null?void 0:u.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"||((d=s==null?void 0:s.paymentInsert)==null?void 0:d.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"?e.jsx("span",{children:(g=(m=s==null?void 0:s.paymentInsert)==null?void 0:m.transactionAmountPaymentCurrency)==null?void 0:g.value}):e.jsx("span",{children:(l=(c=s==null?void 0:s.paymentInsert)==null?void 0:c.transactionAmount)==null?void 0:l.value})]}),((f=s==null?void 0:s.paymentInsert)==null?void 0:f.payer)&&e.jsx(i,{variant:"uppercase",className:"flex items-center gap-2",children:["payer: ",e.jsx(_,{text:((v=s==null?void 0:s.paymentInsert)==null?void 0:v.payer)||""})]}),((P=s==null?void 0:s.paymentInsert)==null?void 0:P.payee)&&e.jsx(i,{variant:"uppercase",className:"flex items-center gap-2",children:["payee: ",e.jsx(_,{text:((N=s==null?void 0:s.paymentInsert)==null?void 0:N.payee)||""})]}),((C=s==null?void 0:s.paymentInsert)==null?void 0:C.isTransactionDone)&&e.jsx(i,{variant:"uppercase",className:"flex items-center gap-2",children:((I=s.paymentInsert)==null?void 0:I.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"||((w=s.paymentInsert)==null?void 0:w.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"?["client secret: ",e.jsx(_,{text:((O=s==null?void 0:s.paymentInsert)==null?void 0:O.clientSecret)||"",cutText:!0})]:["txid: ",e.jsx(_,{text:((p=s==null?void 0:s.paymentInsert)==null?void 0:p.transactionId)||"",cutText:!0})]})]})}function Ze({orderDetails:r}){var s,n;const t=(s=r==null?void 0:r.promoCode)==null?void 0:s.promoCodeInsert;return t&&e.jsxs("div",{className:"flex flex-row lg:flex-col gap-2",children:[e.jsx(i,{variant:"uppercase",children:`promo applied: ${t.code} - ${(n=t.discount)==null?void 0:n.value}%`}),t.freeShipping&&e.jsx(i,{variant:"uppercase",children:"free ship"}),t.voucher&&e.jsx(i,{variant:"uppercase",children:"voucher"})]})}function B({shipping:r}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs(i,{variant:"uppercase",children:["street adress: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.addressLineOne})]}),e.jsxs(i,{variant:"uppercase",children:["city: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.city})]}),(r==null?void 0:r.state)&&e.jsxs(i,{variant:"uppercase",children:["state: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.state})]}),e.jsxs(i,{variant:"uppercase",children:["country: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.country})]}),e.jsxs(i,{variant:"uppercase",children:["postal code: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.postalCode})]})]})}function ae({trackingNumber:r,isPrinting:t,handleTrackingNumberChange:s,saveTrackingNumber:n}){return e.jsx("div",{className:y("w-full border border-textColor",{hidden:t}),children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(Ce,{name:"trackingNumber",placeholder:"tracking number",className:"placeholder:uppercase border border-b border-transparent h-9",value:r,onChange:s}),e.jsx(S,{onClick:n,variant:"main",size:"lg",children:"+"})]})})}function Je({isEdit:r,isPrinting:t,trackingNumber:s,orderStatus:n,orderDetails:a,toggleTrackNumber:o,handleTrackingNumberChange:u,saveTrackingNumber:d}){var m,g;return e.jsx(e.Fragment,{children:((m=a==null?void 0:a.shipment)==null?void 0:m.trackingCode)&&e.jsx("div",{className:"w-full",children:r&&!t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{isPrinting:t,trackingNumber:s,handleTrackingNumberChange:u,saveTrackingNumber:d}),e.jsx(S,{variant:"main",className:"cursor-pointer",size:"lg",onClick:o,children:"close"})]}):!t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"uppercase",children:["tracking number: ",(g=a==null?void 0:a.shipment)==null?void 0:g.trackingCode]}),n==="SHIPPED"&&e.jsx(S,{variant:"main",className:"px-1 cursor-pointer",onClick:o,children:"edit"})]})})})}function Xe({orderDetails:r,isPrinting:t,orderStatus:s,isEdit:n,trackingNumber:a,toggleTrackNumber:o,handleTrackingNumberChange:u,saveTrackingNumber:d}){var v,P,N,C;const{dictionary:m}=$(),[g,c]=x.useState(!1),l=(v=r==null?void 0:r.shipping)==null?void 0:v.addressInsert,f=(P=r==null?void 0:r.billing)==null?void 0:P.addressInsert;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-4 print:hidden",children:[e.jsx(S,{onClick:()=>c(!1),variant:g?"simpleReverse":"main",className:"p-1",children:"Shipping"}),e.jsx(S,{onClick:()=>c(!0),variant:g?"main":"simpleReverse",className:"p-1",children:"Billing"})]}),g?f&&e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(i,{variant:"uppercase",className:"font-bold",children:"billing address:"}),e.jsx(B,{shipping:f})]}):l&&e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(i,{variant:"uppercase",className:"font-bold",children:"shipping:"}),e.jsx(B,{shipping:l}),e.jsx(i,{variant:"uppercase",children:`cost: ${(C=(N=r==null?void 0:r.shipment)==null?void 0:N.cost)==null?void 0:C.value} ${m==null?void 0:m.baseCurrency}`}),e.jsx("div",{className:"w-full",children:e.jsx(Je,{isEdit:n,isPrinting:t,trackingNumber:a,orderStatus:s||"",orderDetails:r,toggleTrackNumber:o,handleTrackingNumberChange:u,saveTrackingNumber:d})})]})]})}const De=r=>{const{dictionary:t}=$(),s=we(p=>p.showMessage),[n,a]=x.useState({orderDetails:void 0,dictionary:void 0,orderStatus:void 0,isLoading:!1}),[o,u]=x.useState(!1),[d,m]=x.useState(!1),[g,c]=x.useState(""),[l,f]=x.useState([]);async function v(){a(p=>({...p,isLoading:!0}));try{const p=await M.GetOrderByUUID({orderUuid:r});a(j=>{var b,h;return{...j,orderDetails:p.order,dictionary:t,orderStatus:Ie(t,(h=(b=p.order)==null?void 0:b.order)==null?void 0:h.orderStatusId)}})}catch(p){const j=p instanceof Error?p.message:"Error fetching order details";s(j,"error")}finally{a(p=>({...p,isLoading:!1}))}}x.useEffect(()=>{v()},[r,t]),x.useEffect(()=>{const p=()=>u(!0),j=()=>u(!1);return window.addEventListener("beforeprint",p),window.addEventListener("afterprint",j),()=>{window.removeEventListener("beforeprint",p),window.removeEventListener("afterprint",j)}},[]);const P=()=>{var p,j;!o&&n.orderStatus==="SHIPPED"&&(m(!d),d&&c(((j=(p=n.orderDetails)==null?void 0:p.shipment)==null?void 0:j.trackingCode)||""))};function N(p){c(p.target.value)}const C=async()=>{var p,j;if(!g.trim()){m(!1);return}try{await M.SetTrackingNumber({orderUuid:(j=(p=n.orderDetails)==null?void 0:p.order)==null?void 0:j.uuid,trackingCode:g}),v(),m(!1)}catch(b){const h=b instanceof Error?b.message:"Failed to save tracking number";s(h,"error")}};async function I(){var j,b;if(window.confirm("Are you sure you want to mark this order as delivered?"))try{await M.DeliveredOrder({orderUuid:(b=(j=n.orderDetails)==null?void 0:j.order)==null?void 0:b.uuid}),v(),s("Order marked as delivered successfully","success")}catch(h){const E=h instanceof Error?h.message:"Failed to mark as delivered";s(E,"error")}}async function w(){var j,b;if(window.confirm("Are you sure you want to refund this order?"))try{await M.RefundOrder({orderUuid:(b=(j=n.orderDetails)==null?void 0:j.order)==null?void 0:b.uuid,orderItemIds:l.length?l:[]}),v(),f([]),s("Order refunded successfully","success")}catch(h){const E=h instanceof Error?h.message:"Failed to refund order";s(E,"error")}}return{...n,isPrinting:o,isEdit:d,trackingNumber:g,selectedOrderItemIds:l,saveTrackingNumber:C,toggleTrackNumber:P,handleTrackingNumberChange:N,markAsDelivered:I,refundOrder:w,toggleOrderItemsSelection:p=>{p.length&&f(j=>{if(p.every(E=>j.includes(E)))return j.filter(E=>!p.includes(E));const h=[...j];return p.forEach(E=>{h.includes(E)||h.push(E)}),h})}}};function nr(){var v,P,N,C,I;const{uuid:r}=Oe(),{orderDetails:t,orderStatus:s,isPrinting:n,isEdit:a,trackingNumber:o,toggleTrackNumber:u,handleTrackingNumberChange:d,saveTrackingNumber:m,markAsDelivered:g,refundOrder:c,selectedOrderItemIds:l,toggleOrderItemsSelection:f}=De(r||"");return e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[n&&e.jsx("div",{className:"self-start h-10 pt-2",children:e.jsx(Ee,{})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Qe,{orderDetails:t,orderStatus:s,isPrinting:!0}),e.jsx(Ke,{orderDetails:t,isPrinting:n,showRefundSelection:s==="DELIVERED",selectedOrderItemIds:l,onToggleOrderItems:f}),e.jsx(i,{variant:"uppercase",className:"font-bold self-end",children:`Total: ${(P=(v=t==null?void 0:t.order)==null?void 0:v.totalPrice)==null?void 0:P.value} ${(N=t==null?void 0:t.order)==null?void 0:N.currency}`}),e.jsx("div",{className:"block self-end print:hidden",children:e.jsx(Ze,{orderDetails:t})}),e.jsxs("div",{className:"flex gap-10 lg:gap-0 lg:flex-row flex-col lg:items-end lg:justify-between w-full",children:[e.jsx(Ve,{orderDetails:t,isPrinting:n}),e.jsx(Xe,{orderDetails:t,isPrinting:n,orderStatus:s,isEdit:a,trackingNumber:o,toggleTrackNumber:u,handleTrackingNumberChange:d,saveTrackingNumber:m}),e.jsx(Ae,{buyer:(C=t==null?void 0:t.buyer)==null?void 0:C.buyerInsert,isPrinting:n})]})]}),s==="REFUNDED"&&e.jsxs("div",{className:"flex flex-col gap-2 w-full lg:w-2/5",children:[e.jsx(i,{variant:"uppercase",className:"font-bold",children:"refund reason:"}),e.jsx("div",{className:"flex flex-wrap gap-3 w-full lg:w-4/5",children:Se.map((w,O)=>e.jsx(S,{type:"button",size:"lg",className:"border border-textColor uppercase",children:w},O))})]}),s==="CONFIRMED"&&!((I=t==null?void 0:t.shipment)!=null&&I.trackingCode)&&e.jsx("div",{className:"w-full lg:w-1/4",children:e.jsx(ae,{isPrinting:n,trackingNumber:o,handleTrackingNumberChange:d,saveTrackingNumber:m})}),s==="SHIPPED"&&e.jsx("div",{className:"fixed right-2.5 lg:absolute bottom-2.5 lg:left-1/2 lg:-translate-x-1/2 flex justify-center print:hidden",children:e.jsx(S,{variant:"main",size:"lg",onClick:g,children:"mark as delivered"})}),s==="CONFIRMED"||s==="DELIVERED"&&e.jsx("div",{className:"fixed right-2.5 lg:absolute bottom-2.5 lg:left-1/2 lg:-translate-x-1/2 flex justify-center print:hidden",children:e.jsx(S,{variant:"main",size:"lg",onClick:c,children:"refund order"})}),e.jsx(i,{variant:"uppercase",className:"font-bold hidden print:block",children:"If you have any questions, please send an email to customercare@grbpwr.com"})]})}export{nr as OrderDetails};
