import{j as e}from"./mui-uYomrlsc.js";import{T as i,C as _,c as A,x as W,y as oe,R as ce,z as le,A as ie,D as z,P as Y,E as T,G as q,H as G,J as de,K as ue,N as pe,O as xe,Q as fe,S as me,V as he,W as ge,X as ve,Y as Q,B as w,Z as je,a as $,$ as Ne,d as Pe,a0 as be,a1 as Ce,p as Ie,b as k,a2 as Ee,a3 as we,a4 as Se}from"./index-Df4UlpnH.js";import{S as F}from"./filter-B8x8g7tl.js";import{r as f,d as Oe}from"./vendor-DljJgkTU.js";function Ae({buyer:r,isPrinting:t}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(i,{variant:"uppercase",className:"font-bold",children:"buyer information:"}),e.jsx(i,{className:"flex items-center gap-2",variant:"uppercase",children:["email: ",e.jsx(i,{component:"span",className:"lowercase select-all",children:e.jsx(_,{text:(r==null?void 0:r.email)||""})})]}),e.jsxs(i,{variant:"uppercase",children:["first name: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.firstName})]}),e.jsxs(i,{variant:"uppercase",children:["last name: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.lastName})]}),e.jsxs(i,{variant:"uppercase",children:["phone: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.phone})]}),e.jsx(i,{variant:"uppercase",className:A({hidden:t}),children:["receive promo emails: ",r!=null&&r.receivePromoEmails?e.jsx(i,{component:"span",className:F.confirmed,children:"yes"}):e.jsx(i,{component:"span",className:F.denied,children:"no"})]})]})}var L="Popover",[K]=le(L,[W]),M=W(),[ye,O]=K(L),V=r=>{const{__scopePopover:t,children:s,open:a,defaultOpen:n,onOpenChange:o,modal:u=!1}=r,d=M(t),m=f.useRef(null),[g,c]=f.useState(!1),[l,x]=oe({prop:a,defaultProp:n??!1,onChange:o,caller:L});return e.jsx(ce,{...d,children:e.jsx(ye,{scope:t,contentId:ie(),triggerRef:m,open:l,onOpenChange:x,onOpenToggle:f.useCallback(()=>x(v=>!v),[x]),hasCustomAnchor:g,onCustomAnchorAdd:f.useCallback(()=>c(!0),[]),onCustomAnchorRemove:f.useCallback(()=>c(!1),[]),modal:u,children:s})})};V.displayName=L;var Z="PopoverAnchor",Re=f.forwardRef((r,t)=>{const{__scopePopover:s,...a}=r,n=O(Z,s),o=M(s),{onCustomAnchorAdd:u,onCustomAnchorRemove:d}=n;return f.useEffect(()=>(u(),()=>d()),[u,d]),e.jsx(q,{...o,...a,ref:t})});Re.displayName=Z;var J="PopoverTrigger",X=f.forwardRef((r,t)=>{const{__scopePopover:s,...a}=r,n=O(J,s),o=M(s),u=z(t,n.triggerRef),d=e.jsx(Y.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":ae(n.open),...a,ref:u,onClick:T(r.onClick,n.onOpenToggle)});return n.hasCustomAnchor?d:e.jsx(q,{asChild:!0,...o,children:d})});X.displayName=J;var H="PopoverPortal",[_e,Te]=K(H,{forceMount:void 0}),D=r=>{const{__scopePopover:t,forceMount:s,children:a,container:n}=r,o=O(H,t);return e.jsx(_e,{scope:t,forceMount:s,children:e.jsx(G,{present:s||o.open,children:e.jsx(de,{asChild:!0,container:n,children:a})})})};D.displayName=H;var R="PopoverContent",ee=f.forwardRef((r,t)=>{const s=Te(R,r.__scopePopover),{forceMount:a=s.forceMount,...n}=r,o=O(R,r.__scopePopover);return e.jsx(G,{present:a||o.open,children:o.modal?e.jsx(ke,{...n,ref:t}):e.jsx(Fe,{...n,ref:t})})});ee.displayName=R;var Me=xe("PopoverContent.RemoveScroll"),ke=f.forwardRef((r,t)=>{const s=O(R,r.__scopePopover),a=f.useRef(null),n=z(t,a),o=f.useRef(!1);return f.useEffect(()=>{const u=a.current;if(u)return ue(u)},[]),e.jsx(pe,{as:Me,allowPinchZoom:!0,children:e.jsx(re,{...r,ref:n,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:T(r.onCloseAutoFocus,u=>{var d;u.preventDefault(),o.current||(d=s.triggerRef.current)==null||d.focus()}),onPointerDownOutside:T(r.onPointerDownOutside,u=>{const d=u.detail.originalEvent,m=d.button===0&&d.ctrlKey===!0,g=d.button===2||m;o.current=g},{checkForDefaultPrevented:!1}),onFocusOutside:T(r.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1})})})}),Fe=f.forwardRef((r,t)=>{const s=O(R,r.__scopePopover),a=f.useRef(!1),n=f.useRef(!1);return e.jsx(re,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var u,d;(u=r.onCloseAutoFocus)==null||u.call(r,o),o.defaultPrevented||(a.current||(d=s.triggerRef.current)==null||d.focus(),o.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:o=>{var m,g;(m=r.onInteractOutside)==null||m.call(r,o),o.defaultPrevented||(a.current=!0,o.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const u=o.target;((g=s.triggerRef.current)==null?void 0:g.contains(u))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&n.current&&o.preventDefault()}})}),re=f.forwardRef((r,t)=>{const{__scopePopover:s,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:o,disableOutsidePointerEvents:u,onEscapeKeyDown:d,onPointerDownOutside:m,onFocusOutside:g,onInteractOutside:c,...l}=r,x=O(R,s),v=M(s);return fe(),e.jsx(me,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:o,children:e.jsx(he,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:c,onEscapeKeyDown:d,onPointerDownOutside:m,onFocusOutside:g,onDismiss:()=>x.onOpenChange(!1),children:e.jsx(ge,{"data-state":ae(x.open),role:"dialog",id:x.contentId,...v,...l,ref:t,style:{...l.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),se="PopoverClose",te=f.forwardRef((r,t)=>{const{__scopePopover:s,...a}=r,n=O(se,s);return e.jsx(Y.button,{type:"button",...a,ref:t,onClick:T(r.onClick,()=>n.onOpenChange(!1))})});te.displayName=se;var Le="PopoverArrow",Ue=f.forwardRef((r,t)=>{const{__scopePopover:s,...a}=r,n=M(s);return e.jsx(ve,{...n,...a,ref:t})});Ue.displayName=Le;function ae(r){return r?"open":"closed"}var $e=V,He=X,Be=D,We=ee,ze=te;function Ye({openElement:r,title:t,children:s,contentProps:a,className:n,gap:o="default",variant:u="default"}){const[d,m]=f.useState(!1);return e.jsxs($e,{open:d,onOpenChange:m,children:[e.jsx(He,{className:"flex items-center",children:typeof r=="function"?r(d):r}),e.jsx(qe,{className:n,title:t,gap:o,variant:u,...a,children:s})]})}function qe({children:r,title:t,className:s,gap:a="default",variant:n="default",...o}){return e.jsx(Be,{children:e.jsxs(We,{side:"bottom",align:"center",className:A("relative z-20 w-full space-y-10 border border-textInactiveColor bg-bgColor px-2.5",{"space-y-16":a==="large","border-none":n==="no-borders"},s),...o,children:[t&&e.jsx(ze,{className:A("fixed left-2 right-2 top-2.5 bg-bgColor","appearance-none border-0 outline-none focus:outline-none"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{variant:"uppercase",children:t}),e.jsx(i,{children:"[x]"})]})}),e.jsx("div",{className:"relative max-h-[50vh] overflow-y-scroll",children:e.jsx("div",{className:"sticky top-0",children:r})})]})})}function Ge({orderDetails:r}){var t;return e.jsx(Ye,{variant:"default",contentProps:{align:"start",sideOffset:10},className:"p-5 bg-bgColor text-textColor",openElement:()=>e.jsx(w,{className:"border border-textInactiveColor rounded px-1 cursor-pointer",children:"i"}),children:e.jsx("div",{className:"flex flex-col gap-y-2",children:(t=r==null?void 0:r.statusHistory)==null?void 0:t.map(s=>{var a,n;return e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsxs(i,{children:[(n=(a=s.status)==null?void 0:a.replace("ORDER_STATUS_ENUM_",""))==null?void 0:n.replace("_"," "),": "]}),e.jsx(i,{children:Q(s.changedAt,!0)})]},s.id)})})})}function Qe({orderDetails:r,orderStatus:t,isPrinting:s}){var o,u,d;const a=je(t),n=Q((o=r==null?void 0:r.order)==null?void 0:o.placed,!0);return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[e.jsx(i,{variant:"uppercase",className:A("block",{"print:hidden":s}),children:`order id: ${(u=r==null?void 0:r.order)==null?void 0:u.id}`}),e.jsxs(i,{variant:"uppercase",children:["order reference: ",e.jsx("span",{className:"select-all",children:(d=r==null?void 0:r.order)==null?void 0:d.uuid})]}),e.jsxs("div",{className:"flex items-center gap-2 print:hidden",children:[e.jsx(i,{variant:"uppercase",children:"status:"}),e.jsx(i,{variant:"uppercase",className:A(a),children:t}),e.jsx(Ge,{orderDetails:r})]}),e.jsx(i,{variant:"uppercase",children:`placed: ${n}`})]})}const U="hidden lg:table-cell";function Ke({orderDetails:r,isPrinting:t=!1,showRefundSelection:s=!1,selectedOrderItemIds:a=[],onToggleOrderItems:n}){var g;const{dictionary:o}=$(),u=f.useMemo(()=>[{label:"THUMBNAIL",showOnPrint:!0,accessor:c=>{var l;return e.jsx("a",{href:`${Ne}/products/${(l=c.orderItem)==null?void 0:l.productId}`,target:"_blank",rel:"noopener noreferrer",className:"cursor-pointer flex items-center justify-center w-24 h-full mx-auto",children:e.jsx(Pe,{src:c.thumbnail||"",alt:"thumbnail",aspectRatio:"1/1",fit:"contain"})})}},{label:"SKU",showOnPrint:!0,className:U,accessor:c=>c.sku},{label:"PRODUCT NAME",showOnPrint:!0,accessor:c=>{var l;return(l=c.translations)==null?void 0:l[0].name}},{label:"QTY",showOnPrint:!1,accessor:c=>{var l;return c.aggregatedQuantity??((l=c.orderItem)==null?void 0:l.quantity)}},{label:"SIZE",showOnPrint:!1,accessor:c=>{var l,x,v;return(v=(x=(l=o==null?void 0:o.sizes)==null?void 0:l.find(P=>{var N;return P.id===((N=c.orderItem)==null?void 0:N.sizeId)}))==null?void 0:x.name)==null?void 0:v.replace("SIZE_ENUM_","")}},{label:"PRICE",showOnPrint:!1,className:U,accessor:c=>{var l,x;return`${c.aggregatedBasePrice??(c.productPrice&&((l=c.orderItem)!=null&&l.quantity)?c.productPrice*c.orderItem.quantity:0)} ${((x=r==null?void 0:r.order)==null?void 0:x.currency)||""}`}},{label:"SALE",showOnPrint:!1,className:U,accessor:c=>c.productSalePercentage},{label:"PRICE WITH SALE",showOnPrint:!0,accessor:c=>{var l;return`${c.aggregatedPriceWithSale??c.productPriceWithSale} ${((l=r==null?void 0:r.order)==null?void 0:l.currency)||""}`}}],[o,(g=r==null?void 0:r.order)==null?void 0:g.currency]),d=f.useMemo(()=>t?u.filter(c=>c.showOnPrint):u,[u,t]),m=f.useMemo(()=>{if(!(r!=null&&r.orderItems))return[];const c=new Map;return r.orderItems.forEach(l=>{var S,p,j,b;const x=((S=l.orderItem)==null?void 0:S.productId)??l.sku??`${l.thumbnail}-${((j=(p=l.translations)==null?void 0:p[0])==null?void 0:j.name)??""}`,v=c.get(x),P=Number(((b=l.orderItem)==null?void 0:b.quantity)??0),C=Number(l.productPrice??0)*P,E=Number(l.productPriceWithSale??0),I=typeof l.id=="number"?l.id:void 0;if(v){const h=v;h.aggregatedQuantity=Number(h.aggregatedQuantity??0)+P,h.aggregatedBasePrice=Number(h.aggregatedBasePrice??0)+C,h.aggregatedPriceWithSale=Number(h.aggregatedPriceWithSale??0)+E,I&&(h.orderItemIds=Array.isArray(h.orderItemIds)?[...h.orderItemIds,I]:[I])}else{const h={...l};h.aggregatedQuantity=P,h.aggregatedBasePrice=C,h.aggregatedPriceWithSale=E,h.orderItemIds=I?[I]:[],c.set(x,h)}}),Array.from(c.values())},[r==null?void 0:r.orderItems]);return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full border-collapse border-2 border-textColor min-w-max",children:[e.jsx("thead",{className:"bg-textInactiveColor h-10",children:e.jsxs("tr",{className:"border-b border-textColor",children:[s&&!t&&e.jsx("th",{className:"text-center w-10 border border-r border-textColor px-2",children:e.jsx(i,{variant:"uppercase",className:"leading-none",children:"refund"})}),d.map(c=>e.jsx("th",{className:`text-center w-auto lg:min-w-26 border border-r border-textColor px-2 ${c.className||""}`,children:e.jsx(i,{variant:"uppercase",className:"leading-none",children:c.label})},c.label))]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:d.length,className:"text-center py-8",children:e.jsx(i,{variant:"uppercase",children:"no items found"})})}):m.map((c,l)=>{const x=Array.isArray(c.orderItemIds)?c.orderItemIds:[],v=x.length>0&&x.every(N=>a.includes(N)),P=()=>{!x.length||!n||n(x)};return e.jsxs("tr",{className:"border-b border-text last:border-b-0 lg:w-24 ",children:[s&&!t&&e.jsx("td",{className:"border border-textColor text-center px-2 w-10",children:e.jsx("input",{type:"checkbox",checked:v,onChange:P,className:"cursor-pointer"})}),d.map(N=>e.jsx("td",{className:`border border-textColor text-center px-2 w-16  lg:w-auto ${N.className||""}`,children:N.label==="THUMBNAIL"?N.accessor(c):e.jsx(i,{children:N.accessor(c)})},N.label))]},l)})})]})})})}function Ve({orderDetails:r,isPrinting:t}){var a,n,o,u,d,m,g,c,l,x,v,P,N,C,E,I,S,p;const s=r==null?void 0:r.payment;return e.jsxs("div",{className:A("flex flex-col gap-1",{hidden:t}),children:[e.jsx(i,{variant:"uppercase",className:"font-bold",children:"payment:"}),e.jsxs(i,{variant:"uppercase",children:["status:"," ",(a=s==null?void 0:s.paymentInsert)!=null&&a.isTransactionDone?e.jsx(i,{component:"span",className:F.confirmed,children:"paid"}):e.jsx(i,{component:"span",className:F.denied,children:"unpaid"})]}),e.jsxs(i,{variant:"uppercase",children:["made at: ",be(s==null?void 0:s.modifiedAt)]}),e.jsxs(i,{variant:"uppercase",children:["payment method:"," ",(o=(n=s==null?void 0:s.paymentInsert)==null?void 0:n.paymentMethod)==null?void 0:o.replace("PAYMENT_METHOD_NAME_ENUM_","")]}),e.jsx(i,{variant:"uppercase",children:["amount: ",((u=s==null?void 0:s.paymentInsert)==null?void 0:u.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"||((d=s==null?void 0:s.paymentInsert)==null?void 0:d.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"?e.jsx("span",{children:(g=(m=s==null?void 0:s.paymentInsert)==null?void 0:m.transactionAmountPaymentCurrency)==null?void 0:g.value}):e.jsx("span",{children:(l=(c=s==null?void 0:s.paymentInsert)==null?void 0:c.transactionAmount)==null?void 0:l.value})]}),((x=s==null?void 0:s.paymentInsert)==null?void 0:x.payer)&&e.jsx(i,{variant:"uppercase",className:"flex items-center gap-2",children:["payer: ",e.jsx(_,{text:((v=s==null?void 0:s.paymentInsert)==null?void 0:v.payer)||""})]}),((P=s==null?void 0:s.paymentInsert)==null?void 0:P.payee)&&e.jsx(i,{variant:"uppercase",className:"flex items-center gap-2",children:["payee: ",e.jsx(_,{text:((N=s==null?void 0:s.paymentInsert)==null?void 0:N.payee)||""})]}),((C=s==null?void 0:s.paymentInsert)==null?void 0:C.isTransactionDone)&&e.jsx(i,{variant:"uppercase",className:"flex items-center gap-2",children:((E=s.paymentInsert)==null?void 0:E.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"||((I=s.paymentInsert)==null?void 0:I.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"?["client secret: ",e.jsx(_,{text:((S=s==null?void 0:s.paymentInsert)==null?void 0:S.clientSecret)||"",cutText:!0})]:["txid: ",e.jsx(_,{text:((p=s==null?void 0:s.paymentInsert)==null?void 0:p.transactionId)||"",cutText:!0})]})]})}function Ze({orderDetails:r}){var s,a;const t=(s=r==null?void 0:r.promoCode)==null?void 0:s.promoCodeInsert;return t&&e.jsxs("div",{className:"flex flex-row lg:flex-col gap-2",children:[e.jsx(i,{variant:"uppercase",children:`promo applied: ${t.code} - ${(a=t.discount)==null?void 0:a.value}%`}),t.freeShipping&&e.jsx(i,{variant:"uppercase",children:"free ship"}),t.voucher&&e.jsx(i,{variant:"uppercase",children:"voucher"})]})}function B({shipping:r}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs(i,{variant:"uppercase",children:["street adress: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.addressLineOne})]}),e.jsxs(i,{variant:"uppercase",children:["city: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.city})]}),(r==null?void 0:r.state)&&e.jsxs(i,{variant:"uppercase",children:["state: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.state})]}),e.jsxs(i,{variant:"uppercase",children:["country: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.country})]}),e.jsxs(i,{variant:"uppercase",children:["postal code: ",e.jsx("span",{className:"select-all",children:r==null?void 0:r.postalCode})]})]})}function ne({trackingNumber:r,isPrinting:t,handleTrackingNumberChange:s,saveTrackingNumber:a}){return e.jsx("div",{className:A("w-full border border-textColor",{hidden:t}),children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(Ce,{name:"trackingNumber",placeholder:"tracking number",className:"placeholder:uppercase border border-b border-transparent h-9",value:r,onChange:s}),e.jsx(w,{onClick:a,variant:"main",size:"lg",children:"+"})]})})}function Je({isEdit:r,isPrinting:t,trackingNumber:s,orderStatus:a,orderDetails:n,toggleTrackNumber:o,handleTrackingNumberChange:u,saveTrackingNumber:d}){var m,g;return e.jsx(e.Fragment,{children:((m=n==null?void 0:n.shipment)==null?void 0:m.trackingCode)&&e.jsx("div",{className:"w-full",children:r&&!t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{isPrinting:t,trackingNumber:s,handleTrackingNumberChange:u,saveTrackingNumber:d}),e.jsx(w,{variant:"main",className:"cursor-pointer",size:"lg",onClick:o,children:"close"})]}):!t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"uppercase",children:["tracking number: ",(g=n==null?void 0:n.shipment)==null?void 0:g.trackingCode]}),a==="SHIPPED"&&e.jsx(w,{variant:"main",className:"px-1 cursor-pointer",onClick:o,children:"edit"})]})})})}function Xe({orderDetails:r,isPrinting:t,orderStatus:s,isEdit:a,trackingNumber:n,toggleTrackNumber:o,handleTrackingNumberChange:u,saveTrackingNumber:d}){var v,P,N,C;const{dictionary:m}=$(),[g,c]=f.useState(!1),l=(v=r==null?void 0:r.shipping)==null?void 0:v.addressInsert,x=(P=r==null?void 0:r.billing)==null?void 0:P.addressInsert;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-4 print:hidden",children:[e.jsx(w,{onClick:()=>c(!1),variant:g?"simpleReverse":"main",className:"p-1",children:"Shipping"}),e.jsx(w,{onClick:()=>c(!0),variant:g?"main":"simpleReverse",className:"p-1",children:"Billing"})]}),g?x&&e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(i,{variant:"uppercase",className:"font-bold",children:"billing address:"}),e.jsx(B,{shipping:x})]}):l&&e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(i,{variant:"uppercase",className:"font-bold",children:"shipping:"}),e.jsx(B,{shipping:l}),e.jsx(i,{variant:"uppercase",children:`cost: ${(C=(N=r==null?void 0:r.shipment)==null?void 0:N.cost)==null?void 0:C.value} ${m==null?void 0:m.baseCurrency}`}),e.jsx("div",{className:"w-full",children:e.jsx(Je,{isEdit:a,isPrinting:t,trackingNumber:n,orderStatus:s||"",orderDetails:r,toggleTrackNumber:o,handleTrackingNumberChange:u,saveTrackingNumber:d})})]})]})}const De=r=>{const{dictionary:t}=$(),s=Ie(p=>p.showMessage),[a,n]=f.useState({orderDetails:void 0,dictionary:void 0,orderStatus:void 0,isLoading:!1}),[o,u]=f.useState(!1),[d,m]=f.useState(!1),[g,c]=f.useState(""),[l,x]=f.useState([]);async function v(){n(p=>({...p,isLoading:!0}));try{const p=await k.GetOrderByUUID({orderUuid:r});n(j=>{var b,h;return{...j,orderDetails:p.order,dictionary:t,orderStatus:Ee(t,(h=(b=p.order)==null?void 0:b.order)==null?void 0:h.orderStatusId)}})}catch(p){const j=p instanceof Error?p.message:"Error fetching order details";s(j,"error")}finally{n(p=>({...p,isLoading:!1}))}}f.useEffect(()=>{v()},[r,t]),f.useEffect(()=>{const p=()=>u(!0),j=()=>u(!1);return window.addEventListener("beforeprint",p),window.addEventListener("afterprint",j),()=>{window.removeEventListener("beforeprint",p),window.removeEventListener("afterprint",j)}},[]);const P=()=>{var p,j;!o&&a.orderStatus==="SHIPPED"&&(m(!d),d&&c(((j=(p=a.orderDetails)==null?void 0:p.shipment)==null?void 0:j.trackingCode)||""))};function N(p){c(p.target.value)}const C=async()=>{var p,j;if(!g.trim()){m(!1);return}try{await k.SetTrackingNumber({orderUuid:(j=(p=a.orderDetails)==null?void 0:p.order)==null?void 0:j.uuid,trackingCode:g}),v(),m(!1)}catch(b){const h=b instanceof Error?b.message:"Failed to save tracking number";s(h,"error")}};async function E(){var p,j;try{await k.DeliveredOrder({orderUuid:(j=(p=a.orderDetails)==null?void 0:p.order)==null?void 0:j.uuid}),v()}catch(b){const h=b instanceof Error?b.message:"Failed to mark as delivered";s(h,"error")}}async function I(){var p,j;try{await k.RefundOrder({orderUuid:(j=(p=a.orderDetails)==null?void 0:p.order)==null?void 0:j.uuid,orderItemIds:l.length?l:[]}),v(),x([])}catch(b){const h=b instanceof Error?b.message:"Failed to refund order";s(h,"error")}}return{...a,isPrinting:o,isEdit:d,trackingNumber:g,selectedOrderItemIds:l,saveTrackingNumber:C,toggleTrackNumber:P,handleTrackingNumberChange:N,markAsDelivered:E,refundOrder:I,toggleOrderItemsSelection:p=>{p.length&&x(j=>{if(p.every(y=>j.includes(y)))return j.filter(y=>!p.includes(y));const h=[...j];return p.forEach(y=>{h.includes(y)||h.push(y)}),h})}}};function ar(){var v,P,N,C,E;const{uuid:r}=Oe(),{orderDetails:t,orderStatus:s,isPrinting:a,isEdit:n,trackingNumber:o,toggleTrackNumber:u,handleTrackingNumberChange:d,saveTrackingNumber:m,markAsDelivered:g,refundOrder:c,selectedOrderItemIds:l,toggleOrderItemsSelection:x}=De(r||"");return e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[a&&e.jsx("div",{className:"self-start h-10 pt-2",children:e.jsx(we,{})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Qe,{orderDetails:t,orderStatus:s,isPrinting:!0}),e.jsx(Ke,{orderDetails:t,isPrinting:a,showRefundSelection:s==="DELIVERED",selectedOrderItemIds:l,onToggleOrderItems:x}),e.jsx(i,{variant:"uppercase",className:"font-bold self-end",children:`Total: ${(P=(v=t==null?void 0:t.order)==null?void 0:v.totalPrice)==null?void 0:P.value} ${(N=t==null?void 0:t.order)==null?void 0:N.currency}`}),e.jsx("div",{className:"block self-end print:hidden",children:e.jsx(Ze,{orderDetails:t})}),e.jsxs("div",{className:"flex gap-10 lg:gap-0 lg:flex-row flex-col lg:items-end lg:justify-between w-full",children:[e.jsx(Ve,{orderDetails:t,isPrinting:a}),e.jsx(Xe,{orderDetails:t,isPrinting:a,orderStatus:s,isEdit:n,trackingNumber:o,toggleTrackNumber:u,handleTrackingNumberChange:d,saveTrackingNumber:m}),e.jsx(Ae,{buyer:(C=t==null?void 0:t.buyer)==null?void 0:C.buyerInsert,isPrinting:a})]})]}),s==="REFUNDED"&&e.jsxs("div",{className:"flex flex-col gap-2 w-full lg:w-2/5",children:[e.jsx(i,{variant:"uppercase",className:"font-bold",children:"refund reason:"}),e.jsx("div",{className:"flex flex-wrap gap-3 w-full lg:w-4/5",children:Se.map((I,S)=>e.jsx(w,{type:"button",size:"lg",className:"border border-textColor uppercase",children:I},S))})]}),s==="CONFIRMED"&&!((E=t==null?void 0:t.shipment)!=null&&E.trackingCode)&&e.jsx("div",{className:"w-full lg:w-1/4",children:e.jsx(ne,{isPrinting:a,trackingNumber:o,handleTrackingNumberChange:d,saveTrackingNumber:m})}),s==="SHIPPED"&&e.jsx("div",{className:"fixed right-2.5 lg:absolute bottom-2.5 lg:left-1/2 lg:-translate-x-1/2 flex justify-center print:hidden",children:e.jsx(w,{variant:"main",size:"lg",onClick:g,children:"mark as delivered"})}),s==="CONFIRMED"||s==="DELIVERED"&&e.jsx("div",{className:"fixed right-2.5 lg:absolute bottom-2.5 lg:left-1/2 lg:-translate-x-1/2 flex justify-center print:hidden",children:e.jsx(w,{variant:"main",size:"lg",onClick:c,children:"refund order"})}),e.jsx(i,{variant:"uppercase",className:"font-bold hidden print:block",children:"If you have any questions, please send an email to customercare@grbpwr.com"})]})}export{ar as OrderDetails};
