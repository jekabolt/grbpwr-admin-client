import{j as e}from"./mui-uYomrlsc.js";import{T as c,C as S,c as P,x as y,y as _,a as k,z as L,d as U,A as R,D as $,B as I,p as B,b as C,E as H,G as z,R as W}from"./index-Cbx8Fi8J.js";import{S as T}from"./filter-B8x8g7tl.js";import{r as w,d as q}from"./vendor-DljJgkTU.js";function F({buyer:s,isPrinting:n}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(c,{variant:"uppercase",className:"font-bold",children:"buyer information:"}),e.jsx(c,{className:"flex items-center gap-2",variant:"uppercase",children:["email: ",e.jsx(c,{component:"span",className:"lowercase select-all",children:e.jsx(S,{text:(s==null?void 0:s.email)||""})})]}),e.jsxs(c,{variant:"uppercase",children:["first name: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.firstName})]}),e.jsxs(c,{variant:"uppercase",children:["last name: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.lastName})]}),e.jsxs(c,{variant:"uppercase",children:["phone: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.phone})]}),e.jsx(c,{variant:"uppercase",className:P({hidden:n}),children:["receive promo emails: ",s!=null&&s.receivePromoEmails?e.jsx(c,{component:"span",className:T.confirmed,children:"yes"}):e.jsx(c,{component:"span",className:T.denied,children:"no"})]})]})}function Y({orderDetails:s,orderStatus:n,isPrinting:a}){var x,h,r;const i=_(n),m=y((x=s==null?void 0:s.order)==null?void 0:x.placed,!0);return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[e.jsx(c,{variant:"uppercase",className:P("block",{"print:hidden":a}),children:`order id: ${(h=s==null?void 0:s.order)==null?void 0:h.id}`}),e.jsxs(c,{variant:"uppercase",children:["order reference: ",e.jsx("span",{className:"select-all",children:(r=s==null?void 0:s.order)==null?void 0:r.uuid})]}),e.jsxs("div",{className:"flex items-center gap-2 print:hidden",children:[e.jsx(c,{variant:"uppercase",children:"status:"}),e.jsx(c,{variant:"uppercase",className:P(i),children:n})]}),e.jsx(c,{variant:"uppercase",children:`placed: ${m}`})]})}const M="hidden lg:table-cell";function Q({orderDetails:s,isPrinting:n=!1}){var h;const{dictionary:a}=k(),i=w.useMemo(()=>[{label:"THUMBNAIL",showOnPrint:!0,accessor:r=>{var t;return e.jsx("a",{href:`${L}/products/${(t=r.orderItem)==null?void 0:t.productId}`,target:"_blank",rel:"noopener noreferrer",className:"cursor-pointer flex items-center justify-center w-24 h-full mx-auto",children:e.jsx(U,{src:r.thumbnail||"",alt:"thumbnail",aspectRatio:"1/1",fit:"contain"})})}},{label:"SKU",showOnPrint:!0,className:M,accessor:r=>r.sku},{label:"PRODUCT NAME",showOnPrint:!0,accessor:r=>{var t;return(t=r.translations)==null?void 0:t[0].name}},{label:"QTY",showOnPrint:!1,accessor:r=>{var t;return r.aggregatedQuantity??((t=r.orderItem)==null?void 0:t.quantity)}},{label:"SIZE",showOnPrint:!1,accessor:r=>{var t,o,f;return(f=(o=(t=a==null?void 0:a.sizes)==null?void 0:t.find(p=>{var g;return p.id===((g=r.orderItem)==null?void 0:g.sizeId)}))==null?void 0:o.name)==null?void 0:f.replace("SIZE_ENUM_","")}},{label:"PRICE",showOnPrint:!1,className:M,accessor:r=>{var t,o;return`${r.aggregatedBasePrice??(r.productPrice&&((t=r.orderItem)!=null&&t.quantity)?r.productPrice*r.orderItem.quantity:0)} ${((o=s==null?void 0:s.order)==null?void 0:o.currency)||""}`}},{label:"SALE",showOnPrint:!1,className:M,accessor:r=>r.productSalePercentage},{label:"PRICE WITH SALE",showOnPrint:!0,accessor:r=>{var t;return`${r.aggregatedPriceWithSale??r.productPriceWithSale} ${((t=s==null?void 0:s.order)==null?void 0:t.currency)||""}`}}],[a,(h=s==null?void 0:s.order)==null?void 0:h.currency]),m=w.useMemo(()=>n?i.filter(r=>r.showOnPrint):i,[i,n]),x=w.useMemo(()=>{if(!(s!=null&&s.orderItems))return[];const r=new Map;return s.orderItems.forEach(t=>{var v,b,l,u;const o=((v=t.orderItem)==null?void 0:v.productId)??t.sku??`${t.thumbnail}-${((l=(b=t.translations)==null?void 0:b[0])==null?void 0:l.name)??""}`,f=r.get(o),p=Number(((u=t.orderItem)==null?void 0:u.quantity)??0),j=Number(t.productPrice??0)*p,N=Number(t.productPriceWithSale??0);if(f){const d=f;d.aggregatedQuantity=Number(d.aggregatedQuantity??0)+p,d.aggregatedBasePrice=Number(d.aggregatedBasePrice??0)+j,d.aggregatedPriceWithSale=Number(d.aggregatedPriceWithSale??0)+N}else{const d={...t};d.aggregatedQuantity=p,d.aggregatedBasePrice=j,d.aggregatedPriceWithSale=N,r.set(o,d)}}),Array.from(r.values())},[s==null?void 0:s.orderItems]);return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full border-collapse border-2 border-textColor min-w-max",children:[e.jsx("thead",{className:"bg-textInactiveColor h-10",children:e.jsx("tr",{className:"border-b border-textColor",children:m.map(r=>e.jsx("th",{className:`text-center w-auto lg:min-w-26 border border-r border-textColor px-2 ${r.className||""}`,children:e.jsx(c,{variant:"uppercase",className:"leading-none",children:r.label})},r.label))})}),e.jsx("tbody",{children:x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:m.length,className:"text-center py-8",children:e.jsx(c,{variant:"uppercase",children:"no items found"})})}):x.map((r,t)=>e.jsx("tr",{className:"border-b border-text last:border-b-0 lg:w-24 ",children:m.map(o=>e.jsx("td",{className:`border border-textColor text-center px-2 w-16  lg:w-auto ${o.className||""}`,children:o.label==="THUMBNAIL"?o.accessor(r):e.jsx(c,{children:o.accessor(r)})},o.label))},t))})]})})})}function G({orderDetails:s,isPrinting:n}){var i,m,x,h,r,t,o,f,p,g,j,N,v,b,l,u,d,E;const a=s==null?void 0:s.payment;return e.jsxs("div",{className:P("flex flex-col gap-1",{hidden:n}),children:[e.jsx(c,{variant:"uppercase",className:"font-bold",children:"payment:"}),e.jsxs(c,{variant:"uppercase",children:["status:"," ",(i=a==null?void 0:a.paymentInsert)!=null&&i.isTransactionDone?e.jsx(c,{component:"span",className:T.confirmed,children:"paid"}):e.jsx(c,{component:"span",className:T.denied,children:"unpaid"})]}),e.jsxs(c,{variant:"uppercase",children:["made at: ",R(a==null?void 0:a.modifiedAt)]}),e.jsxs(c,{variant:"uppercase",children:["payment method:"," ",(x=(m=a==null?void 0:a.paymentInsert)==null?void 0:m.paymentMethod)==null?void 0:x.replace("PAYMENT_METHOD_NAME_ENUM_","")]}),e.jsx(c,{variant:"uppercase",children:["amount: ",((h=a==null?void 0:a.paymentInsert)==null?void 0:h.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"||((r=a==null?void 0:a.paymentInsert)==null?void 0:r.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"?e.jsx("span",{children:(o=(t=a==null?void 0:a.paymentInsert)==null?void 0:t.transactionAmountPaymentCurrency)==null?void 0:o.value}):e.jsx("span",{children:(p=(f=a==null?void 0:a.paymentInsert)==null?void 0:f.transactionAmount)==null?void 0:p.value})]}),((g=a==null?void 0:a.paymentInsert)==null?void 0:g.payer)&&e.jsx(c,{variant:"uppercase",className:"flex items-center gap-2",children:["payer: ",e.jsx(S,{text:((j=a==null?void 0:a.paymentInsert)==null?void 0:j.payer)||""})]}),((N=a==null?void 0:a.paymentInsert)==null?void 0:N.payee)&&e.jsx(c,{variant:"uppercase",className:"flex items-center gap-2",children:["payee: ",e.jsx(S,{text:((v=a==null?void 0:a.paymentInsert)==null?void 0:v.payee)||""})]}),((b=a==null?void 0:a.paymentInsert)==null?void 0:b.isTransactionDone)&&e.jsx(c,{variant:"uppercase",className:"flex items-center gap-2",children:((l=a.paymentInsert)==null?void 0:l.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"||((u=a.paymentInsert)==null?void 0:u.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"?["client secret: ",e.jsx(S,{text:((d=a==null?void 0:a.paymentInsert)==null?void 0:d.clientSecret)||"",cutText:!0})]:["txid: ",e.jsx(S,{text:((E=a==null?void 0:a.paymentInsert)==null?void 0:E.transactionId)||"",cutText:!0})]})]})}function Z({orderDetails:s}){var a,i;const n=(a=s==null?void 0:s.promoCode)==null?void 0:a.promoCodeInsert;return n&&e.jsxs("div",{className:"flex flex-row lg:flex-col gap-2",children:[e.jsx(c,{variant:"uppercase",children:`promo applied: ${n.code} - ${(i=n.discount)==null?void 0:i.value}%`}),n.freeShipping&&e.jsx(c,{variant:"uppercase",children:"free ship"}),n.voucher&&e.jsx(c,{variant:"uppercase",children:"voucher"})]})}function O({shipping:s}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs(c,{variant:"uppercase",children:["street adress: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.addressLineOne})]}),e.jsxs(c,{variant:"uppercase",children:["city: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.city})]}),(s==null?void 0:s.state)&&e.jsxs(c,{variant:"uppercase",children:["state: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.state})]}),e.jsxs(c,{variant:"uppercase",children:["country: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.country})]}),e.jsxs(c,{variant:"uppercase",children:["postal code: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.postalCode})]})]})}function A({trackingNumber:s,isPrinting:n,handleTrackingNumberChange:a,saveTrackingNumber:i}){return e.jsx("div",{className:P("w-full border border-textColor",{hidden:n}),children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx($,{name:"trackingNumber",placeholder:"tracking number",className:"placeholder:uppercase border border-b border-transparent h-9",value:s,onChange:a}),e.jsx(I,{onClick:i,variant:"main",size:"lg",children:"+"})]})})}function K({isEdit:s,isPrinting:n,trackingNumber:a,orderStatus:i,orderDetails:m,toggleTrackNumber:x,handleTrackingNumberChange:h,saveTrackingNumber:r}){var t,o;return e.jsx(e.Fragment,{children:((t=m==null?void 0:m.shipment)==null?void 0:t.trackingCode)&&e.jsx("div",{className:"w-full",children:s&&!n?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{isPrinting:n,trackingNumber:a,handleTrackingNumberChange:h,saveTrackingNumber:r}),e.jsx(I,{variant:"main",className:"cursor-pointer",size:"lg",onClick:x,children:"close"})]}):!n&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"uppercase",children:["tracking number: ",(o=m==null?void 0:m.shipment)==null?void 0:o.trackingCode]}),i==="SHIPPED"&&e.jsx(I,{variant:"main",className:"px-1 cursor-pointer",onClick:x,children:"edit"})]})})})}function V({orderDetails:s,isPrinting:n,orderStatus:a,isEdit:i,trackingNumber:m,toggleTrackNumber:x,handleTrackingNumberChange:h,saveTrackingNumber:r}){var j,N,v,b;const{dictionary:t}=k(),[o,f]=w.useState(!1),p=(j=s==null?void 0:s.shipping)==null?void 0:j.addressInsert,g=(N=s==null?void 0:s.billing)==null?void 0:N.addressInsert;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-4 print:hidden",children:[e.jsx(I,{onClick:()=>f(!1),variant:o?"simpleReverse":"main",className:"p-1",children:"Shipping"}),e.jsx(I,{onClick:()=>f(!0),variant:o?"main":"simpleReverse",className:"p-1",children:"Billing"})]}),o?g&&e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(c,{variant:"uppercase",className:"font-bold",children:"billing address:"}),e.jsx(O,{shipping:g})]}):p&&e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(c,{variant:"uppercase",className:"font-bold",children:"shipping:"}),e.jsx(O,{shipping:p}),e.jsx(c,{variant:"uppercase",children:`cost: ${(b=(v=s==null?void 0:s.shipment)==null?void 0:v.cost)==null?void 0:b.value} ${t==null?void 0:t.baseCurrency}`}),e.jsx("div",{className:"w-full",children:e.jsx(K,{isEdit:i,isPrinting:n,trackingNumber:m,orderStatus:a||"",orderDetails:s,toggleTrackNumber:x,handleTrackingNumberChange:h,saveTrackingNumber:r})})]})]})}const J=s=>{const{dictionary:n}=k(),a=B(l=>l.showMessage),[i,m]=w.useState({orderDetails:void 0,dictionary:void 0,orderStatus:void 0,isLoading:!1}),[x,h]=w.useState(!1),[r,t]=w.useState(!1),[o,f]=w.useState("");async function p(){m(l=>({...l,isLoading:!0}));try{const l=await C.GetOrderByUUID({orderUuid:s});m(u=>{var d,E;return{...u,orderDetails:l.order,dictionary:n,orderStatus:H(n,(E=(d=l.order)==null?void 0:d.order)==null?void 0:E.orderStatusId)}})}catch(l){const u=l instanceof Error?l.message:"Error fetching order details";a(u,"error")}finally{m(l=>({...l,isLoading:!1}))}}w.useEffect(()=>{p()},[s,n]),w.useEffect(()=>{const l=()=>h(!0),u=()=>h(!1);return window.addEventListener("beforeprint",l),window.addEventListener("afterprint",u),()=>{window.removeEventListener("beforeprint",l),window.removeEventListener("afterprint",u)}},[]);const g=()=>{var l,u;!x&&i.orderStatus==="SHIPPED"&&(t(!r),r&&f(((u=(l=i.orderDetails)==null?void 0:l.shipment)==null?void 0:u.trackingCode)||""))};function j(l){f(l.target.value)}const N=async()=>{var l,u;if(!o.trim()){t(!1);return}try{await C.SetTrackingNumber({orderUuid:(u=(l=i.orderDetails)==null?void 0:l.order)==null?void 0:u.uuid,trackingCode:o}),p(),t(!1)}catch(d){const E=d instanceof Error?d.message:"Failed to save tracking number";a(E,"error")}};async function v(){var l,u;try{await C.DeliveredOrder({orderUuid:(u=(l=i.orderDetails)==null?void 0:l.order)==null?void 0:u.uuid}),p()}catch(d){const E=d instanceof Error?d.message:"Failed to mark as delivered";a(E,"error")}}async function b(){var l,u;try{await C.RefundOrder({orderUuid:(u=(l=i.orderDetails)==null?void 0:l.order)==null?void 0:u.uuid}),p()}catch(d){const E=d instanceof Error?d.message:"Failed to refund order";a(E,"error")}}return{...i,isPrinting:x,isEdit:r,trackingNumber:o,saveTrackingNumber:N,toggleTrackNumber:g,handleTrackingNumberChange:j,markAsDelivered:v,refundOrder:b}};function ae(){var p,g,j,N,v;const{uuid:s}=q(),{orderDetails:n,orderStatus:a,isPrinting:i,isEdit:m,trackingNumber:x,toggleTrackNumber:h,handleTrackingNumberChange:r,saveTrackingNumber:t,markAsDelivered:o,refundOrder:f}=J(s||"");return e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[i&&e.jsx("div",{className:"self-start h-10 pt-2",children:e.jsx(z,{})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Y,{orderDetails:n,orderStatus:a,isPrinting:!0}),e.jsx(Q,{orderDetails:n,isPrinting:i}),e.jsx(c,{variant:"uppercase",className:"font-bold self-end",children:`Total: ${(g=(p=n==null?void 0:n.order)==null?void 0:p.totalPrice)==null?void 0:g.value} ${(j=n==null?void 0:n.order)==null?void 0:j.currency}`}),e.jsx("div",{className:"block self-end print:hidden",children:e.jsx(Z,{orderDetails:n})}),e.jsxs("div",{className:"flex gap-10 lg:gap-0 lg:flex-row flex-col lg:items-end lg:justify-between w-full",children:[e.jsx(G,{orderDetails:n,isPrinting:i}),e.jsx(V,{orderDetails:n,isPrinting:i,orderStatus:a,isEdit:m,trackingNumber:x,toggleTrackNumber:h,handleTrackingNumberChange:r,saveTrackingNumber:t}),e.jsx(F,{buyer:(N=n==null?void 0:n.buyer)==null?void 0:N.buyerInsert,isPrinting:i})]})]}),a==="REFUNDED"&&e.jsxs("div",{className:"flex flex-col gap-2 w-full lg:w-2/5",children:[e.jsx(c,{variant:"uppercase",className:"font-bold",children:"refund reason:"}),e.jsx("div",{className:"flex flex-wrap gap-3 w-full lg:w-4/5",children:W.map((b,l)=>e.jsx(I,{type:"button",size:"lg",className:"border border-textColor uppercase",children:b},l))})]}),a==="CONFIRMED"&&!((v=n==null?void 0:n.shipment)!=null&&v.trackingCode)&&e.jsx("div",{className:"w-full lg:w-1/4",children:e.jsx(A,{isPrinting:i,trackingNumber:x,handleTrackingNumberChange:r,saveTrackingNumber:t})}),a==="SHIPPED"&&e.jsx("div",{className:"fixed right-2.5 lg:absolute bottom-2.5 lg:left-1/2 lg:-translate-x-1/2 flex justify-center print:hidden",children:e.jsx(I,{variant:"main",size:"lg",onClick:o,children:"mark as delivered"})}),a==="CONFIRMED"||a==="DELIVERED"&&e.jsx("div",{className:"fixed right-2.5 lg:absolute bottom-2.5 lg:left-1/2 lg:-translate-x-1/2 flex justify-center print:hidden",children:e.jsx(I,{variant:"main",size:"lg",onClick:f,children:"refund order"})}),e.jsx(c,{variant:"uppercase",className:"font-bold hidden print:block",children:"If you have any questions, please send an email to customercare@grbpwr.com"})]})}export{ae as OrderDetails};
