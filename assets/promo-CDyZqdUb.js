import{j as e}from"./mui-8bJoa1Af.js";import{r as d}from"./vendor-DljJgkTU.js";import{p as j,a1 as N,B as R,T as D,b as S}from"./index-DCfRxWnN.js";import{C as P}from"./checkbox-C9pj_Q6L.js";import{A as M}from"./AdapterDateFns-ALShuase.js";import{ab as T,aa as O}from"./DatePicker-CKJvWQug.js";import"./index-B8DvyK-M.js";const A=(m,n)=>{const a=new Date(m);return a.setMonth(a.getMonth()+n),a},y=({createNewPromo:m})=>{var E;const{showMessage:n}=j(),a=A(new Date,3),s={code:"",freeShipping:!1,discount:{value:""},expiration:a.toISOString(),allowed:!0,voucher:!1,start:new Date().toISOString()},[o,i]=d.useState(s),[h,x]=d.useState(""),[f,l]=d.useState(""),g=r=>{const t=r.target.value;i(c=>({...c,code:t})),f&&l("")},u=r=>{const t=r.target.value;/^\d*$/.test(t)&&(parseInt(t,10)>100?x("discount cannot exceed 100%"):x(""),i(c=>({...c,discount:{value:t}})))},p=r=>t=>{i(c=>({...c,[r]:t}))},C=(r,t)=>{if(!t)return;const c=new Date(t);c.setHours(12,0,0,0),i(I=>({...I,[r]:c.toISOString()}))},v=r=>{const t=r.trim();return/^[a-zA-Z0-9-_]+$/.test(t)?(l(""),!0):(n("Promo code can only contain letters, numbers, hyphens, and underscores, and cannot contain spaces","error"),!1)},w=()=>{var t,c;if(((t=o.code)==null?void 0:t.trim())===""){l("Promo code is required");return}else l("");if(!v(o.code||""))return;if(parseFloat(((c=o.discount)==null?void 0:c.value)||"")>100){n("PROMO CAN'T BE CREATED: DISCOUNT CAN'T BE MORE THAN A HUNDRED","error");return}const r={...o,code:o.code};m(r),i(s)};return e.jsx(T,{dateAdapter:M,children:e.jsxs("div",{className:"flex flex-col gap-2 items-start",children:[e.jsxs("div",{className:"flex lg:flex-row flex-col gap-2 items-center w-full order-2 sm:order-1",children:[e.jsx("div",{className:"w-full",children:e.jsx(N,{name:"code",placeholder:"PROMO CODE",value:o.code||"",onChange:g,className:"h-10"})}),e.jsxs("div",{className:"space-y-1 w-full",children:[e.jsx(N,{name:"discount",placeholder:"DISCOUNT",value:(E=o.discount)==null?void 0:E.value,onChange:u,className:"h-10"}),h&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:h})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(O,{value:o.start?new Date(o.start):null,onChange:r=>C("start",r),label:"START DATE",slotProps:{textField:{size:"small",required:!0}}}),e.jsx(O,{value:o.expiration?new Date(o.expiration):null,onChange:r=>C("expiration",r),minDate:new Date,label:"EXPIRATION DATE",slotProps:{textField:{size:"small",required:!0}}})]}),e.jsx(R,{size:"lg",onClick:w,className:"lg:w-96 w-full",children:"Create Promo"})]}),e.jsxs("div",{className:"flex gap-2 order-1 sm:order-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{size:"small",variant:"uppercase",children:"free shipping"}),e.jsx(P,{name:"freeShipping",size:"large",checked:o.freeShipping,onChange:p("freeShipping")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{size:"small",variant:"uppercase",children:"allowed"}),e.jsx(P,{name:"allowed",size:"large",checked:o.allowed,onChange:p("allowed")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{size:"small",variant:"uppercase",children:"voucher"}),e.jsx(P,{name:"voucher",size:"large",checked:o.voucher,onChange:p("voucher")})]})]})]})})},k=({promos:m,fetchPromos:n})=>{const{showMessage:a}=j();return m.map((s,o)=>{var i,h,x,f,l,g,u;return{id:o,code:(i=s.promoCodeInsert)==null?void 0:i.code,freeShipping:(h=s.promoCodeInsert)!=null&&h.freeShipping?"free":"paid",discount:(x=s.promoCodeInsert)!=null&&x.discount?`${s.promoCodeInsert.discount.value}%`:"",start:(f=s.promoCodeInsert)!=null&&f.start?new Date(s.promoCodeInsert.start).toLocaleDateString("en-US",{year:"numeric",month:"numeric",day:"numeric"}):void 0,expiration:(l=s.promoCodeInsert)!=null&&l.expiration?new Date(s.promoCodeInsert.expiration).toLocaleDateString("en-US",{year:"numeric",month:"numeric",day:"numeric"}):void 0,allowed:(g=s.promoCodeInsert)==null?void 0:g.allowed,voucher:(u=s.promoCodeInsert)==null?void 0:u.voucher}}),d.useCallback(async s=>{if(s)try{await S.DeletePromoCode({code:s}),a("PROMO REMOVED FROM LIST","success"),n(50,0)}catch(o){const i=o instanceof Error?o.message:"PROMO CAN'T BE REMOVED FROM LIST";a(i,"error")}},[]),e.jsx("div",{children:"promo"})},z=(m=!1,n=!0)=>{const{showMessage:a}=j(),[s,o]=d.useState([]),[i,h]=d.useState(m),[x,f]=d.useState(n),l=d.useCallback(async(u,p)=>{h(!0);const v=(await S.ListPromos({limit:u,offset:p,orderFactor:"ORDER_FACTOR_DESC"})).promoCodes||[];o(w=>p===0?v:[...w,...v]),h(!1),f(l.length===u)},[]),g=d.useCallback(async u=>{try{await S.AddPromo({promo:u}),a("PROMO CREATED","success"),l(50,0)}catch(p){const C=p instanceof Error?p.message:"Failed to create promo";a(C,"error")}},[s]);return{promos:s,fetchPromos:l,createNewPromo:g}},_=()=>{const{promos:m,fetchPromos:n,createNewPromo:a}=z();return d.useEffect(()=>{n(50,0)},[n]),e.jsxs("div",{className:"flex flex-col gap-10",children:[e.jsx(y,{createNewPromo:a}),e.jsx(k,{promos:m,fetchPromos:n})]})};export{_ as Promo};
