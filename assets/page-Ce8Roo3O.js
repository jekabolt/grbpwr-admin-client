import{j as e}from"./mui-8bJoa1Af.js";import{T as a,C as k,c as P,x as L,B as O,y as H,a as R,z as F,d as z,A as Y,D as G,p as q,b as y,E as W,G as Z,R as K}from"./index-DJFsu7OP.js";import{S as M}from"./filter-B8x8g7tl.js";import{R as V,T as J,P as Q,C as X,a as D}from"./index-CR8CXE_p.js";import{r as S,d as ee}from"./vendor-DljJgkTU.js";function se({buyer:s,isPrinting:n}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(a,{variant:"uppercase",className:"font-bold",children:"buyer information:"}),e.jsx(a,{className:"flex items-center gap-2",variant:"uppercase",children:["email: ",e.jsx(a,{component:"span",className:"lowercase select-all",children:e.jsx(k,{text:(s==null?void 0:s.email)||""})})]}),e.jsxs(a,{variant:"uppercase",children:["first name: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.firstName})]}),e.jsxs(a,{variant:"uppercase",children:["last name: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.lastName})]}),e.jsxs(a,{variant:"uppercase",children:["phone: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.phone})]}),e.jsx(a,{variant:"uppercase",className:P({hidden:n}),children:["receive promo emails: ",s!=null&&s.receivePromoEmails?e.jsx(a,{component:"span",className:M.confirmed,children:"yes"}):e.jsx(a,{component:"span",className:M.denied,children:"no"})]})]})}function re({openElement:s,title:n,children:r,contentProps:l,className:i,gap:m="default",variant:p="default"}){const[x,f]=S.useState(!1);return e.jsxs(V,{open:x,onOpenChange:f,children:[e.jsx(J,{className:"flex items-center",children:typeof s=="function"?s(x):s}),e.jsx(ne,{className:i,title:n,gap:m,variant:p,...l,children:r})]})}function ne({children:s,title:n,className:r,gap:l="default",variant:i="default",...m}){return e.jsx(Q,{children:e.jsxs(X,{side:"bottom",align:"center",className:P("relative z-20 w-full space-y-10 border border-textInactiveColor bg-bgColor px-2.5",{"space-y-16":l==="large","border-none":i==="no-borders"},r),...m,children:[n&&e.jsx(D,{className:P("fixed left-2 right-2 top-2.5 bg-bgColor","appearance-none border-0 outline-none focus:outline-none"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(a,{variant:"uppercase",children:n}),e.jsx(a,{children:"[x]"})]})}),e.jsx("div",{className:"relative max-h-[50vh] overflow-y-scroll",children:e.jsx("div",{className:"sticky top-0",children:s})})]})})}function ae({orderDetails:s}){var n;return e.jsx(re,{variant:"default",contentProps:{align:"start",sideOffset:10},className:"p-5 bg-bgColor text-textColor",openElement:()=>e.jsx(O,{className:"border border-textInactiveColor rounded px-1 cursor-pointer",children:"i"}),children:e.jsx("div",{className:"flex flex-col gap-y-2",children:(n=s==null?void 0:s.statusHistory)==null?void 0:n.map(r=>{var l,i;return e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsxs(a,{children:[(i=(l=r.status)==null?void 0:l.replace("ORDER_STATUS_ENUM_",""))==null?void 0:i.replace("_"," "),": "]}),e.jsx(a,{children:L(r.changedAt,!0)})]},r.id)})})})}function te({orderDetails:s,orderStatus:n,isPrinting:r}){var m,p,x;const l=H(n),i=L((m=s==null?void 0:s.order)==null?void 0:m.placed,!0);return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[e.jsx(a,{variant:"uppercase",className:P("block",{"print:hidden":r}),children:`order id: ${(p=s==null?void 0:s.order)==null?void 0:p.id}`}),e.jsxs(a,{variant:"uppercase",className:"flex items-center gap-2",children:["order reference: ",e.jsx(k,{text:((x=s==null?void 0:s.order)==null?void 0:x.uuid)||""})]}),e.jsxs("div",{className:"flex items-center gap-2 print:hidden",children:[e.jsx(a,{variant:"uppercase",children:"status:"}),e.jsx(a,{variant:"uppercase",className:P(l),children:n}),e.jsx(ae,{orderDetails:s})]}),e.jsx(a,{variant:"uppercase",children:`placed: ${i}`})]})}const A="hidden lg:table-cell";function ce({orderDetails:s,isPrinting:n=!1,showRefundSelection:r=!1,selectedProductIds:l=[],onToggleOrderItems:i}){var f,h,I;const{dictionary:m}=R(),p=S.useMemo(()=>[{label:"THUMBNAIL",showOnPrint:!0,accessor:t=>{var o;return e.jsx("a",{href:`${F}/products/${(o=t.orderItem)==null?void 0:o.productId}`,target:"_blank",rel:"noopener noreferrer",className:"cursor-pointer flex items-center justify-center w-24 h-full mx-auto",children:e.jsx(z,{src:t.thumbnail||"",alt:"thumbnail",aspectRatio:"1/1",fit:"contain"})})}},{label:"SKU",showOnPrint:!0,className:A,accessor:t=>t.sku},{label:"PRODUCT NAME",showOnPrint:!0,accessor:t=>{var o;return(o=t.translations)==null?void 0:o[0].name}},{label:"SIZE",showOnPrint:!1,accessor:t=>{var o,d,j;return(j=(d=(o=m==null?void 0:m.sizes)==null?void 0:o.find(E=>{var b;return E.id===((b=t.orderItem)==null?void 0:b.sizeId)}))==null?void 0:d.name)==null?void 0:j.replace("SIZE_ENUM_","")}},{label:"PRICE",showOnPrint:!1,className:A,accessor:t=>{var o,d;return`${t.aggregatedBasePrice??(t.productPrice&&((o=t.orderItem)!=null&&o.quantity)?t.productPrice*t.orderItem.quantity:0)} ${((d=s==null?void 0:s.order)==null?void 0:d.currency)||""}`}},{label:"SALE",showOnPrint:!1,className:A,accessor:t=>t.productSalePercentage},{label:"PRICE WITH SALE",showOnPrint:!0,accessor:t=>{var o;return`${t.aggregatedPriceWithSale??t.productPriceWithSale} ${((o=s==null?void 0:s.order)==null?void 0:o.currency)||""}`}},{label:"REFUNDED",showOnPrint:!0,accessor:t=>{var o;return(o=s==null?void 0:s.refundedOrderItems)!=null&&o.some(d=>d.id===t.id)?"Yes":"No"}}],[m,(f=s==null?void 0:s.order)==null?void 0:f.currency,s==null?void 0:s.refundedOrderItems]),x=S.useMemo(()=>n?p.filter(t=>t.showOnPrint):p,[p,n]);return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full border-collapse border-2 border-textColor min-w-max",children:[e.jsx("thead",{className:"bg-textInactiveColor h-10",children:e.jsxs("tr",{className:"border-b border-textColor",children:[r&&!n&&e.jsx("th",{className:"text-center w-10 border border-r border-textColor px-2",children:e.jsx(a,{variant:"uppercase",className:"leading-none",children:"refund"})}),x.map(t=>e.jsx("th",{className:`text-center w-auto lg:min-w-26 border border-r border-textColor px-2 ${t.className||""}`,children:e.jsx(a,{variant:"uppercase",className:"leading-none",children:t.label})},t.label))]})}),e.jsx("tbody",{children:((h=s==null?void 0:s.orderItems)==null?void 0:h.length)===0?e.jsx("tr",{children:e.jsx("td",{colSpan:x.length,className:"text-center py-8",children:e.jsx(a,{variant:"uppercase",children:"no items found"})})}):(I=s==null?void 0:s.orderItems)==null?void 0:I.map((t,o)=>{var C;const d=typeof t.id=="number"?t.id:null,j=d!=null?[d]:[],E=d!=null&&((C=s==null?void 0:s.refundedOrderItems)==null?void 0:C.some(N=>N.id===d)),b=j.length>0&&j.every(N=>l.includes(N)),T=()=>{!j.length||!i||i(j)};return e.jsxs("tr",{className:"border-b border-text last:border-b-0 lg:w-24",children:[r&&!n&&e.jsx("td",{className:"border border-textColor text-center px-2 w-10",children:e.jsx("input",{type:"checkbox",checked:b,onChange:T,className:"cursor-pointer"})}),x.map(N=>{var u;const c=N.label!=="THUMBNAIL"&&N.label!=="REFUNDED";return e.jsx("td",{className:P("border border-textColor text-center px-2 w-16 lg:w-auto",N.className,E&&c&&'relative after:content-[""] after:absolute after:left-0 after:right-0 after:top-1/2 after:h-px after:bg-current',{"bg-textInactiveColor/80":(u=s.refundedOrderItems)==null?void 0:u.some(v=>v.id===d)}),children:N.label==="THUMBNAIL"?N.accessor(t):e.jsx(a,{children:N.accessor(t)})},N.label)})]},d??o)})})]})})})}function le({orderDetails:s,isPrinting:n}){var l,i,m,p,x,f,h,I,t,o,d,j,E,b,T,C,N,c;const r=s==null?void 0:s.payment;return e.jsxs("div",{className:P("flex flex-col gap-1",{hidden:n}),children:[e.jsx(a,{variant:"uppercase",className:"font-bold",children:"payment:"}),e.jsxs(a,{variant:"uppercase",children:["status:"," ",(l=r==null?void 0:r.paymentInsert)!=null&&l.isTransactionDone?e.jsx(a,{component:"span",className:M.confirmed,children:"paid"}):e.jsx(a,{component:"span",className:M.denied,children:"unpaid"})]}),e.jsxs(a,{variant:"uppercase",children:["made at: ",Y(r==null?void 0:r.modifiedAt)]}),e.jsxs(a,{variant:"uppercase",children:["payment method:"," ",(m=(i=r==null?void 0:r.paymentInsert)==null?void 0:i.paymentMethod)==null?void 0:m.replace("PAYMENT_METHOD_NAME_ENUM_","")]}),e.jsx(a,{variant:"uppercase",children:["amount: ",((p=r==null?void 0:r.paymentInsert)==null?void 0:p.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"||((x=r==null?void 0:r.paymentInsert)==null?void 0:x.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"?e.jsx("span",{children:(h=(f=r==null?void 0:r.paymentInsert)==null?void 0:f.transactionAmountPaymentCurrency)==null?void 0:h.value}):e.jsx("span",{children:(t=(I=r==null?void 0:r.paymentInsert)==null?void 0:I.transactionAmount)==null?void 0:t.value})]}),((o=r==null?void 0:r.paymentInsert)==null?void 0:o.payer)&&e.jsx(a,{variant:"uppercase",className:"flex items-center gap-2",children:["payer: ",e.jsx(k,{text:((d=r==null?void 0:r.paymentInsert)==null?void 0:d.payer)||""})]}),((j=r==null?void 0:r.paymentInsert)==null?void 0:j.payee)&&e.jsx(a,{variant:"uppercase",className:"flex items-center gap-2",children:["payee: ",e.jsx(k,{text:((E=r==null?void 0:r.paymentInsert)==null?void 0:E.payee)||""})]}),((b=r==null?void 0:r.paymentInsert)==null?void 0:b.isTransactionDone)&&e.jsx(a,{variant:"uppercase",className:"flex items-center gap-2",children:((T=r.paymentInsert)==null?void 0:T.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"||((C=r.paymentInsert)==null?void 0:C.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"?["client secret: ",e.jsx(k,{text:((N=r==null?void 0:r.paymentInsert)==null?void 0:N.clientSecret)||"",cutText:!0})]:["txid: ",e.jsx(k,{text:((c=r==null?void 0:r.paymentInsert)==null?void 0:c.transactionId)||"",cutText:!0})]})]})}function oe({orderDetails:s}){var r,l;const n=(r=s==null?void 0:s.promoCode)==null?void 0:r.promoCodeInsert;return n&&e.jsxs("div",{className:"flex flex-row lg:flex-col gap-2",children:[e.jsx(a,{variant:"uppercase",children:`promo applied: ${n.code} - ${(l=n.discount)==null?void 0:l.value}%`}),n.freeShipping&&e.jsx(a,{variant:"uppercase",children:"free ship"}),n.voucher&&e.jsx(a,{variant:"uppercase",children:"voucher"})]})}function _({shipping:s}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs(a,{variant:"uppercase",children:["street adress: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.addressLineOne})]}),e.jsxs(a,{variant:"uppercase",children:["city: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.city})]}),(s==null?void 0:s.state)&&e.jsxs(a,{variant:"uppercase",children:["state: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.state})]}),e.jsxs(a,{variant:"uppercase",children:["country: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.country})]}),e.jsxs(a,{variant:"uppercase",children:["postal code: ",e.jsx("span",{className:"select-all",children:s==null?void 0:s.postalCode})]})]})}function $({trackingNumber:s,isPrinting:n,handleTrackingNumberChange:r,saveTrackingNumber:l}){return e.jsx("div",{className:P("w-full border border-textColor",{hidden:n}),children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(G,{name:"trackingNumber",placeholder:"tracking number",className:"placeholder:uppercase border border-b border-transparent h-9",value:s,onChange:r}),e.jsx(O,{onClick:l,variant:"main",size:"lg",children:"+"})]})})}function ie({isEdit:s,isPrinting:n,trackingNumber:r,orderStatus:l,orderDetails:i,toggleTrackNumber:m,handleTrackingNumberChange:p,saveTrackingNumber:x}){var f,h;return e.jsx(e.Fragment,{children:((f=i==null?void 0:i.shipment)==null?void 0:f.trackingCode)&&e.jsx("div",{className:"w-full",children:s&&!n?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{isPrinting:n,trackingNumber:r,handleTrackingNumberChange:p,saveTrackingNumber:x}),e.jsx(O,{variant:"main",className:"cursor-pointer",size:"lg",onClick:m,children:"close"})]}):!n&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(a,{variant:"uppercase",children:["tracking number: ",(h=i==null?void 0:i.shipment)==null?void 0:h.trackingCode]}),l==="SHIPPED"&&e.jsx(O,{variant:"main",className:"px-1 cursor-pointer",onClick:m,children:"edit"})]})})})}function de({orderDetails:s,isPrinting:n,orderStatus:r,isEdit:l,trackingNumber:i,toggleTrackNumber:m,handleTrackingNumberChange:p,saveTrackingNumber:x}){var d,j,E,b;const{dictionary:f}=R(),[h,I]=S.useState(!1),t=(d=s==null?void 0:s.shipping)==null?void 0:d.addressInsert,o=(j=s==null?void 0:s.billing)==null?void 0:j.addressInsert;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-4 print:hidden",children:[e.jsx(O,{onClick:()=>I(!1),variant:h?"simpleReverse":"main",className:"p-1",children:"Shipping"}),e.jsx(O,{onClick:()=>I(!0),variant:h?"main":"simpleReverse",className:"p-1",children:"Billing"})]}),h?o&&e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(a,{variant:"uppercase",className:"font-bold",children:"billing address:"}),e.jsx(_,{shipping:o})]}):t&&e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(a,{variant:"uppercase",className:"font-bold",children:"shipping:"}),e.jsx(_,{shipping:t}),e.jsx(a,{variant:"uppercase",children:`cost: ${(b=(E=s==null?void 0:s.shipment)==null?void 0:E.cost)==null?void 0:b.value} ${f==null?void 0:f.baseCurrency}`}),e.jsx("div",{className:"w-full",children:e.jsx(ie,{isEdit:l,isPrinting:n,trackingNumber:i,orderStatus:r||"",orderDetails:s,toggleTrackNumber:m,handleTrackingNumberChange:p,saveTrackingNumber:x})})]})]})}const ue=s=>{const{dictionary:n}=R(),r=q(c=>c.showMessage),[l,i]=S.useState({orderDetails:void 0,dictionary:void 0,orderStatus:void 0,isLoading:!1}),[m,p]=S.useState(!1),[x,f]=S.useState(!1),[h,I]=S.useState(""),[t,o]=S.useState([]);async function d(){i(c=>({...c,isLoading:!0}));try{const c=await y.GetOrderByUUID({orderUuid:s});i(u=>{var v,g;return{...u,orderDetails:c.order,dictionary:n,orderStatus:W(n,(g=(v=c.order)==null?void 0:v.order)==null?void 0:g.orderStatusId)}})}catch(c){const u=c instanceof Error?c.message:"Error fetching order details";r(u,"error")}finally{i(c=>({...c,isLoading:!1}))}}S.useEffect(()=>{d()},[s,n]),S.useEffect(()=>{const c=()=>p(!0),u=()=>p(!1);return window.addEventListener("beforeprint",c),window.addEventListener("afterprint",u),()=>{window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",u)}},[]);const j=()=>{var c,u;!m&&l.orderStatus==="SHIPPED"&&(f(!x),x&&I(((u=(c=l.orderDetails)==null?void 0:c.shipment)==null?void 0:u.trackingCode)||""))};function E(c){I(c.target.value)}const b=async()=>{var c,u;if(!h.trim()){f(!1);return}try{await y.SetTrackingNumber({orderUuid:(u=(c=l.orderDetails)==null?void 0:c.order)==null?void 0:u.uuid,trackingCode:h}),d(),f(!1)}catch(v){const g=v instanceof Error?v.message:"Failed to save tracking number";r(g,"error")}};async function T(){var u,v;if(window.confirm("Are you sure you want to mark this order as delivered?"))try{await y.DeliveredOrder({orderUuid:(v=(u=l.orderDetails)==null?void 0:u.order)==null?void 0:v.uuid}),d(),r("Order marked as delivered successfully","success")}catch(g){const w=g instanceof Error?g.message:"Failed to mark as delivered";r(w,"error")}}async function C(){var u,v;if(window.confirm("Are you sure you want to full refund this order?"))try{await y.RefundOrder({orderUuid:(v=(u=l.orderDetails)==null?void 0:u.order)==null?void 0:v.uuid,orderItemIds:t.length?t:[]}),d(),o([]),r("Order refunded successfully","success")}catch(g){const w=g instanceof Error?g.message:"Failed to refund order";r(w,"error")}}return{...l,isPrinting:m,isEdit:x,trackingNumber:h,selectedProductIds:t,saveTrackingNumber:b,toggleTrackNumber:j,handleTrackingNumberChange:E,markAsDelivered:T,refundOrder:C,toggleOrderItemsSelection:c=>{c.length&&o(u=>{if(c.every(w=>u.includes(w)))return u.filter(w=>!c.includes(w));const g=[...u];return c.forEach(w=>{g.includes(w)||g.push(w)}),g})}}},U=["CONFIRMED","DELIVERED","PENDING RETURN","REFUND IN PROGRESS"];function je(){var d,j,E,b,T,C,N,c,u,v,g;const{uuid:s}=ee(),{orderDetails:n,orderStatus:r,isPrinting:l,isEdit:i,trackingNumber:m,toggleTrackNumber:p,handleTrackingNumberChange:x,saveTrackingNumber:f,markAsDelivered:h,refundOrder:I,selectedProductIds:t,toggleOrderItemsSelection:o}=ue(s||"");return e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[l&&e.jsx("div",{className:"self-start h-10 pt-2",children:e.jsx(Z,{})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(te,{orderDetails:n,orderStatus:r,isPrinting:!0}),e.jsx(ce,{orderDetails:n,isPrinting:l,showRefundSelection:U.includes(r||"")&&!["CONFIRMED"].includes(r||""),selectedProductIds:t,onToggleOrderItems:o}),e.jsx(a,{variant:"uppercase",className:"font-bold self-end",children:`Total: ${(j=(d=n==null?void 0:n.order)==null?void 0:d.totalPrice)==null?void 0:j.value} ${(E=n==null?void 0:n.order)==null?void 0:E.currency}`}),(r==="PARTIALLY REFUNDED"||r==="REFUNDED")&&e.jsx(a,{variant:"uppercase",className:"font-bold self-end",children:`refunded amount: ${(T=(b=n==null?void 0:n.order)==null?void 0:b.refundedAmount)==null?void 0:T.value} ${(C=n==null?void 0:n.order)==null?void 0:C.currency}`}),e.jsxs(a,{variant:"uppercase",className:"font-bold self-end",children:["cost: ",(c=(N=n==null?void 0:n.shipment)==null?void 0:N.cost)==null?void 0:c.value," ",(u=n==null?void 0:n.order)==null?void 0:u.currency]}),e.jsx("div",{className:"block self-end print:hidden",children:e.jsx(oe,{orderDetails:n})}),e.jsxs("div",{className:"flex gap-10 lg:gap-0 lg:flex-row flex-col lg:items-end lg:justify-between w-full",children:[e.jsx(le,{orderDetails:n,isPrinting:l}),e.jsx(de,{orderDetails:n,isPrinting:l,orderStatus:r,isEdit:i,trackingNumber:m,toggleTrackNumber:p,handleTrackingNumberChange:x,saveTrackingNumber:f}),e.jsx(se,{buyer:(v=n==null?void 0:n.buyer)==null?void 0:v.buyerInsert,isPrinting:l})]})]}),r==="REFUNDED"&&e.jsxs("div",{className:"flex flex-col gap-2 w-full lg:w-2/5",children:[e.jsx(a,{variant:"uppercase",className:"font-bold",children:"refund reason:"}),e.jsx("div",{className:"flex flex-wrap gap-3 w-full lg:w-4/5",children:K.map((w,B)=>e.jsx(O,{type:"button",size:"lg",className:"border border-textColor uppercase",children:w},B))})]}),r==="CONFIRMED"&&!((g=n==null?void 0:n.shipment)!=null&&g.trackingCode)&&e.jsx("div",{className:"w-full lg:w-1/4",children:e.jsx($,{isPrinting:l,trackingNumber:m,handleTrackingNumberChange:x,saveTrackingNumber:f})}),r==="SHIPPED"&&e.jsx("div",{className:"fixed right-2.5 lg:absolute bottom-2.5 lg:left-1/2 lg:-translate-x-1/2 flex justify-center print:hidden",children:e.jsx(O,{variant:"main",size:"lg",onClick:h,children:"mark as delivered"})}),U.includes(r||"")&&e.jsx("div",{className:"fixed right-2.5 lg:absolute bottom-2.5 lg:left-1/2 lg:-translate-x-1/2 flex justify-center print:hidden",children:e.jsx(O,{variant:"main",size:"lg",onClick:I,children:"refund order"})}),e.jsx(a,{variant:"uppercase",className:"font-bold hidden print:block",children:"If you have any questions, please send an email to customercare@grbpwr.com"})]})}export{je as OrderDetails};
