import{j as e,aS as $}from"./mui--1QQx6Xz.js";import{T as n,c as v,B as k,C as z,y as A,z as O,A as y,E as P,G as U,P as H,a as b,q as L,b as T,H as R,J as B}from"./index-zdczT18r.js";import{r as g,e as F}from"./vendor-BqCw_tH9.js";import{S as C}from"./filter-Ct7KBysK.js";function M({shipping:a}){return e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{variant:"uppercase",size:"small",children:`street adress: ${a==null?void 0:a.addressLineOne}`}),e.jsx(n,{variant:"uppercase",size:"small",children:`city: ${a==null?void 0:a.city}`}),e.jsx(n,{variant:"uppercase",size:"small",children:`state: ${a==null?void 0:a.state}`}),e.jsx(n,{variant:"uppercase",size:"small",children:`country: ${a==null?void 0:a.country}`}),e.jsx(n,{variant:"uppercase",size:"small",children:`postal code: ${a==null?void 0:a.postalCode}`})]})}function G({orderDetails:a,isPrinting:r}){var d;const s=(d=a==null?void 0:a.billing)==null?void 0:d.addressInsert,[c,t]=g.useState(!1);return e.jsx("div",{className:v("block",{hidden:r}),children:c?e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{variant:"uppercase",className:"font-bold",children:"billing address:"}),e.jsx(M,{shipping:s})]}):e.jsx(k,{onClick:()=>t(!c),size:"lg",children:"show billing info"})})}function Y({buyer:a,isPrinting:r}){return e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(n,{variant:"uppercase",className:"font-bold",children:"buyer information:"}),e.jsx(n,{className:"flex items-center gap-2",variant:"uppercase",size:"small",children:["email: ",e.jsx(n,{component:"span",className:"lowercase",children:e.jsx(z,{text:(a==null?void 0:a.email)||""})})]}),e.jsx(n,{variant:"uppercase",size:"small",children:`first name: ${a==null?void 0:a.firstName}`}),e.jsx(n,{variant:"uppercase",size:"small",children:`last name: ${a==null?void 0:a.lastName}`}),e.jsx(n,{variant:"uppercase",size:"small",children:`phone: ${a==null?void 0:a.phone}`}),e.jsx(n,{variant:"uppercase",size:"small",className:v({hidden:r}),children:["receive promo emails: ",a!=null&&a.receivePromoEmails?e.jsx(n,{component:"span",size:"small",className:C.confirmed,children:"yes"}):e.jsx(n,{component:"span",size:"small",className:C.denied,children:"no"})]})]})}function q({orderDetails:a,orderStatus:r,isPrinting:s}){var m,p,o,u;const c=O(r),t=A((m=a==null?void 0:a.order)==null?void 0:m.placed),d=A((p=a==null?void 0:a.order)==null?void 0:p.modified);return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[e.jsx(n,{variant:"uppercase",size:"small",className:v("block",{"print:hidden":s}),children:`order id: ${(o=a==null?void 0:a.order)==null?void 0:o.id}`}),e.jsx(n,{variant:"uppercase",size:"small",className:v("flex items-center",{"print:hidden":s}),children:["uuid: ",e.jsx(z,{text:((u=a==null?void 0:a.order)==null?void 0:u.uuid)||"",cutText:!0},"copy")]}),e.jsx(n,{variant:"uppercase",className:v(c,{"print:hidden":s}),size:"small",children:`status: ${r}`}),e.jsx(n,{variant:"uppercase",size:"small",className:v("block",{"print:hidden":s}),children:"company adress: adress adress adress"}),e.jsx(n,{variant:"uppercase",size:"small",children:`placed: ${t}`}),e.jsx(n,{variant:"uppercase",size:"small",className:v("block",{"print:hidden":s}),children:`modified: ${d}`})]})}const V=(a,r)=>[{field:"thumbnail",headerName:"",align:"center",width:200,renderCell:s=>e.jsx("a",{href:`${y}/products/${s.row.orderItem.productId}`,target:"_blank",style:{cursor:"pointer"},children:e.jsx("img",{src:s.value,alt:"product",style:{height:"100px",width:"auto"}})})},{field:"sku",headerName:"SKU",align:"center",width:r?150:300,renderCell:s=>e.jsx("div",{style:{whiteSpace:r?"normal":"nowrap",wordWrap:r?"break-word":"normal",overflow:r?"visible":"auto",display:r?"block":"flex",alignItems:"center",lineHeight:r?"1.5":"normal",height:"100%",width:"100%",margin:r?"30% auto":"0"},children:s.value})},{field:"productName",align:"center",headerAlign:"center",headerName:"PRODUCT NAME",width:150},{field:"quantity",headerName:"QUANTITY",headerAlign:"center",align:"center",width:r?100:200,valueGetter:(s,c)=>c.orderItem.quantity},{field:"size",headerName:"SIZE",align:"center",headerAlign:"center",width:200,cellClassName:"print:hidden",valueGetter:(s,c)=>{var t,d,m;return(m=(d=(t=a==null?void 0:a.sizes)==null?void 0:t.find(p=>p.id===c.orderItem.sizeId))==null?void 0:d.name)==null?void 0:m.replace("SIZE_ENUM_","")}},{field:"productPrice",headerName:"PRICE",align:"center",headerAlign:"center",width:r?90:200,valueGetter:(s,c)=>`${s*c.orderItem.quantity} ${a==null?void 0:a.baseCurrency}`},{field:"productSalePercentage",headerName:"SALE",align:"center",headerAlign:"center",width:r?90:200},{field:"productPriceWithSale",align:"center",headerAlign:"center",headerName:r?"PWS":"PRICE WITH SALE",width:r?100:200}];function W({orderDetails:a,isPrinting:r}){var c,t,d,m,p,o,u,N,f,x,I,E,S,w,l,i,h,j;const s=a==null?void 0:a.payment;return e.jsxs("div",{className:v("grid gap-2 w-full",{hidden:r}),children:[e.jsx(n,{variant:"uppercase",className:"font-bold",children:"payment:"}),e.jsxs(n,{variant:"uppercase",size:"small",children:["status:"," ",(c=s==null?void 0:s.paymentInsert)!=null&&c.isTransactionDone?e.jsx(n,{component:"span",size:"small",className:C.confirmed,children:"paid"}):e.jsx(n,{component:"span",size:"small",className:C.denied,children:"unpaid"})]}),e.jsxs(n,{variant:"uppercase",size:"small",children:["made at: ",A(s==null?void 0:s.modifiedAt)]}),e.jsxs(n,{variant:"uppercase",size:"small",children:["payment method:"," ",(d=(t=s==null?void 0:s.paymentInsert)==null?void 0:t.paymentMethod)==null?void 0:d.replace("PAYMENT_METHOD_NAME_ENUM_","")]}),e.jsx(n,{variant:"uppercase",size:"small",children:["amount: ",((m=s==null?void 0:s.paymentInsert)==null?void 0:m.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"||((p=s==null?void 0:s.paymentInsert)==null?void 0:p.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"?e.jsx("span",{children:(u=(o=s==null?void 0:s.paymentInsert)==null?void 0:o.transactionAmountPaymentCurrency)==null?void 0:u.value}):e.jsx("span",{children:(f=(N=s==null?void 0:s.paymentInsert)==null?void 0:N.transactionAmount)==null?void 0:f.value})]}),((x=s==null?void 0:s.paymentInsert)==null?void 0:x.payer)&&e.jsx(n,{variant:"uppercase",size:"small",className:"flex items-center gap-2",children:["payer: ",e.jsx(z,{text:((I=s==null?void 0:s.paymentInsert)==null?void 0:I.payer)||""})]}),((E=s==null?void 0:s.paymentInsert)==null?void 0:E.payee)&&e.jsx(n,{variant:"uppercase",size:"small",className:"flex items-center gap-2",children:["payee: ",e.jsx(z,{text:((S=s==null?void 0:s.paymentInsert)==null?void 0:S.payee)||""})]}),((w=s==null?void 0:s.paymentInsert)==null?void 0:w.isTransactionDone)&&e.jsx(n,{variant:"uppercase",size:"small",className:"flex items-center gap-2",children:((l=s.paymentInsert)==null?void 0:l.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"||((i=s.paymentInsert)==null?void 0:i.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"?["client secret: ",e.jsx(z,{text:((h=s==null?void 0:s.paymentInsert)==null?void 0:h.clientSecret)||"",cutText:!0})]:["txid: ",e.jsx(z,{text:((j=s==null?void 0:s.paymentInsert)==null?void 0:j.transactionId)||"",cutText:!0})]})]})}function Z({orderDetails:a}){var s,c;const r=(s=a==null?void 0:a.promoCode)==null?void 0:s.promoCodeInsert;return r&&e.jsxs("div",{className:"flex flex-row lg:flex-col gap-2",children:[e.jsx(n,{variant:"uppercase",className:"font-bold",children:`promo applied: ${r.code} - ${(c=r.discount)==null?void 0:c.value}%`}),r.freeShipping&&e.jsx(n,{variant:"uppercase",size:"small",children:"free ship"}),r.voucher&&e.jsx(n,{variant:"uppercase",size:"small",children:"voucher"})]})}function _({trackingNumber:a,isPrinting:r,handleTrackingNumberChange:s,saveTrackingNumber:c}){return e.jsx("div",{className:v("w-full lg:w-1/4",{hidden:r}),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{name:"trackingNumber",placeholder:"tracking number",value:a,onChange:s,className:"h-10"}),e.jsx(k,{onClick:c,size:"lg",children:e.jsx(U,{})})]})})}function J({isEdit:a,isPrinting:r,trackingNumber:s,orderStatus:c,orderDetails:t,toggleTrackNumber:d,handleTrackingNumberChange:m,saveTrackingNumber:p}){var o,u;return e.jsx(e.Fragment,{children:((o=t==null?void 0:t.shipment)==null?void 0:o.trackingCode)&&e.jsx("div",{children:a&&!r?e.jsx(_,{isPrinting:r,trackingNumber:s,handleTrackingNumberChange:m,saveTrackingNumber:p}):!r&&e.jsx(n,{variant:"uppercase",size:"small",children:[`tracking number: ${(u=t==null?void 0:t.shipment)==null?void 0:u.trackingCode} `,c==="SHIPPED"&&e.jsx(k,{onClick:d,size:"sm",children:e.jsx(H,{})})]})})})}function K({orderDetails:a,isPrinting:r,orderStatus:s,isEdit:c,trackingNumber:t,toggleTrackNumber:d,handleTrackingNumberChange:m,saveTrackingNumber:p}){var N,f,x;const{dictionary:o}=b(),u=(N=a==null?void 0:a.shipping)==null?void 0:N.addressInsert;return e.jsx("div",{className:"w-full",children:u&&e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(n,{variant:"uppercase",className:"font-bold",children:"shipping:"}),e.jsx(M,{shipping:u}),e.jsx(n,{variant:"uppercase",size:"small",children:`cost: ${(x=(f=a==null?void 0:a.shipment)==null?void 0:f.cost)==null?void 0:x.value} ${o==null?void 0:o.baseCurrency}`}),e.jsx(J,{isEdit:c,isPrinting:r,trackingNumber:t,orderStatus:s||"",orderDetails:a,toggleTrackNumber:d,handleTrackingNumberChange:m,saveTrackingNumber:p})]})})}const Q=a=>{const{dictionary:r}=b(),{showMessage:s}=L(),[c,t]=g.useState({orderDetails:void 0,dictionary:void 0,orderStatus:void 0,isLoading:!1}),[d,m]=g.useState(!1),[p,o]=g.useState(!1),[u,N]=g.useState("");async function f(){t(l=>({...l,isLoading:!0}));try{const l=await T.GetOrderByUUID({orderUuid:a});t(i=>{var h,j;return{...i,orderDetails:l.order,dictionary:r,orderStatus:R(r,(j=(h=l.order)==null?void 0:h.order)==null?void 0:j.orderStatusId)}})}catch(l){const i=l instanceof Error?l.message:"Error fetching order details";s(i,"error")}finally{t(l=>({...l,isLoading:!1}))}}g.useEffect(()=>{f()},[a,r]),g.useEffect(()=>{const l=()=>m(!0),i=()=>m(!1);return window.addEventListener("beforeprint",l),window.addEventListener("afterprint",i),()=>{window.removeEventListener("beforeprint",l),window.removeEventListener("afterprint",i)}},[]);const x=()=>{var l,i;!d&&c.orderStatus==="SHIPPED"&&(o(!p),p&&N(((i=(l=c.orderDetails)==null?void 0:l.shipment)==null?void 0:i.trackingCode)||""))};function I(l){N(l.target.value)}const E=async()=>{var l,i;if(!u.trim()){o(!1);return}try{await T.SetTrackingNumber({orderUuid:(i=(l=c.orderDetails)==null?void 0:l.order)==null?void 0:i.uuid,trackingCode:u}),f(),o(!1)}catch(h){const j=h instanceof Error?h.message:"Failed to save tracking number";s(j,"error")}};async function S(){var l,i;try{await T.DeliveredOrder({orderUuid:(i=(l=c.orderDetails)==null?void 0:l.order)==null?void 0:i.uuid}),f()}catch(h){const j=h instanceof Error?h.message:"Failed to mark as delivered";s(j,"error")}}async function w(){var l,i;try{await T.RefundOrder({orderUuid:(i=(l=c.orderDetails)==null?void 0:l.order)==null?void 0:i.uuid}),f()}catch(h){const j=h instanceof Error?h.message:"Failed to refund order";s(j,"error")}}return{...c,isPrinting:d,isEdit:p,trackingNumber:u,saveTrackingNumber:E,toggleTrackNumber:x,handleTrackingNumberChange:I,markAsDelivered:S,refundOrder:w}};function se(){var E,S,w,l,i;const{uuid:a}=F(),{orderDetails:r,dictionary:s,orderStatus:c,isPrinting:t,isEdit:d,trackingNumber:m,toggleTrackNumber:p,handleTrackingNumberChange:o,saveTrackingNumber:u,markAsDelivered:N,refundOrder:f}=Q(a||""),[x,I]=g.useState({showBilling:!1,page:0,pageSize:5,columnVisibility:{thumbnail:!0,size:!0}});return g.useEffect(()=>{I(h=>({...h,columnVisibility:{thumbnail:!t,size:!t}}))},[t]),e.jsxs("div",{className:"flex flex-col gap-4",children:[t&&e.jsx("div",{className:"self-start h-10 pt-2",children:e.jsx(B,{})}),e.jsx(q,{orderDetails:r,orderStatus:c,isPrinting:!0}),e.jsx($,{rows:(r==null?void 0:r.orderItems)||[],columns:V(s,t),columnVisibilityModel:x.columnVisibility,rowSelection:!1,paginationModel:t?{page:x.page,pageSize:((E=r==null?void 0:r.orderItems)==null?void 0:E.length)||x.pageSize}:{page:x.page,pageSize:x.pageSize},pageSizeOptions:[5,10,20],rowHeight:100,hideFooterPagination:t,hideFooter:t}),e.jsx("div",{className:v("block",{hidden:t}),children:e.jsx(Z,{orderDetails:r})}),e.jsxs("div",{className:v("flex flex-col lg:flex-row justify-between gap-4",{"flex-row items-start":t}),children:[e.jsx(W,{orderDetails:r,isPrinting:t}),e.jsx(K,{orderDetails:r,isPrinting:t,orderStatus:c,isEdit:d,trackingNumber:m,toggleTrackNumber:p,handleTrackingNumberChange:o,saveTrackingNumber:u}),e.jsx(Y,{buyer:(S=r==null?void 0:r.buyer)==null?void 0:S.buyerInsert,isPrinting:t})]}),e.jsx(G,{orderDetails:r,isPrinting:t}),c==="CONFIRMED"&&!((w=r==null?void 0:r.shipment)!=null&&w.trackingCode)&&e.jsx(_,{isPrinting:t,trackingNumber:m,handleTrackingNumberChange:o,saveTrackingNumber:u}),c==="SHIPPED"&&e.jsx(k,{onClick:N,children:"mark as delivered"}),c==="CONFIRMED"||c==="DELIVERED"&&e.jsx(k,{onClick:f,children:"refund order"}),e.jsx(n,{variant:"uppercase",className:"font-bold self-end",children:`Total: ${(i=(l=r==null?void 0:r.order)==null?void 0:l.totalPrice)==null?void 0:i.value} ${s==null?void 0:s.baseCurrency}`}),e.jsx(n,{variant:"uppercase",size:"small",className:"font-bold",children:"If you have any questions, please send an email to customercare@grbpwr.com"})]})}export{se as OrderDetails};
