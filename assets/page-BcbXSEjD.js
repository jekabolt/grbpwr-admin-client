import{j as e}from"./mui-D9Bk7yoK.js";import{T as n,C as T,c as w,y as M,z as _,a as P,A as $,d as U,E as L,B as C,P as R,q as y,b as S,G as H,H as B}from"./index-Dn3nVg0q.js";import{S as k}from"./filter-5_j1tY8F.js";import{r as E,d as z}from"./vendor-DljJgkTU.js";function F({buyer:r,isPrinting:a}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(n,{variant:"uppercase",className:"font-bold",children:"buyer information:"}),e.jsx(n,{className:"flex items-center gap-2",variant:"uppercase",children:["email: ",e.jsx(n,{component:"span",className:"lowercase",children:e.jsx(T,{text:(r==null?void 0:r.email)||""})})]}),e.jsx(n,{variant:"uppercase",children:`first name: ${r==null?void 0:r.firstName}`}),e.jsx(n,{variant:"uppercase",children:`last name: ${r==null?void 0:r.lastName}`}),e.jsx(n,{variant:"uppercase",children:`phone: ${r==null?void 0:r.phone}`}),e.jsx(n,{variant:"uppercase",className:w({hidden:a}),children:["receive promo emails: ",r!=null&&r.receivePromoEmails?e.jsx(n,{component:"span",className:k.confirmed,children:"yes"}):e.jsx(n,{component:"span",className:k.denied,children:"no"})]})]})}function Y({orderDetails:r,orderStatus:a,isPrinting:s}){var c,d,m,u;const l=_(a),o=M((c=r==null?void 0:r.order)==null?void 0:c.placed),t=M((d=r==null?void 0:r.order)==null?void 0:d.modified);return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[e.jsx(n,{variant:"uppercase",className:w("block",{"print:hidden":s}),children:`order id: ${(m=r==null?void 0:r.order)==null?void 0:m.id}`}),e.jsx(n,{variant:"uppercase",children:`order reference: ${(u=r==null?void 0:r.order)==null?void 0:u.uuid}`}),e.jsxs("div",{className:"flex items-center gap-2 print:hidden",children:[e.jsx(n,{variant:"uppercase",children:"status:"}),e.jsx(n,{variant:"uppercase",className:w(l),children:a})]}),e.jsx(n,{variant:"uppercase",children:`placed: ${o}`}),e.jsx(n,{variant:"uppercase",className:w("block",{"print:hidden":s}),children:`modified: ${t}`})]})}function q({orderDetails:r,isPrinting:a=!1}){const{dictionary:s}=P(),l=E.useMemo(()=>[{label:"THUMBNAIL",showOnPrint:!0,accessor:t=>{var c;return e.jsx("a",{href:`${$}/products/${(c=t.orderItem)==null?void 0:c.productId}`,target:"_blank",rel:"noopener noreferrer",className:"cursor-pointer flex items-center justify-center w-24 h-full mx-auto",children:e.jsx(U,{src:t.thumbnail||"",alt:"thumbnail",aspectRatio:"1/1",fit:"contain"})})}},{label:"SKU",showOnPrint:!0,accessor:t=>t.sku},{label:"PRODUCT NAME",showOnPrint:!0,accessor:t=>{var c;return(c=t.translations)==null?void 0:c[0].name}},{label:"QUANTITY",showOnPrint:!1,accessor:t=>{var c;return(c=t.orderItem)==null?void 0:c.quantity}},{label:"SIZE",showOnPrint:!1,accessor:t=>{var c,d,m;return(m=(d=(c=s==null?void 0:s.sizes)==null?void 0:c.find(u=>{var h;return u.id===((h=t.orderItem)==null?void 0:h.sizeId)}))==null?void 0:d.name)==null?void 0:m.replace("SIZE_ENUM_","")}},{label:"PRICE",showOnPrint:!1,accessor:t=>{var c;return`${t.productPrice&&((c=t.orderItem)!=null&&c.quantity)?t.productPrice*t.orderItem.quantity:0} ${s==null?void 0:s.baseCurrency}`}},{label:"SALE",showOnPrint:!1,accessor:t=>t.productSalePercentage},{label:"PRICE WITH SALE",showOnPrint:!0,accessor:t=>t.productPriceWithSale}],[s]),o=E.useMemo(()=>a?l.filter(t=>t.showOnPrint):l,[l,a]);return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full border-collapse border-2 border-textColor min-w-max",children:[e.jsx("thead",{className:"bg-textInactiveColor h-10",children:e.jsx("tr",{className:"border-b border-textColor",children:o.map(t=>e.jsx("th",{className:"text-center h-10 min-w-26 border border-r border-textColor px-2",children:e.jsx(n,{variant:"uppercase",children:t.label})},t.label))})}),e.jsx("tbody",{children:!(r!=null&&r.orderItems)||r.orderItems.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:o.length,className:"text-center py-8",children:e.jsx(n,{variant:"uppercase",children:"no items found"})})}):r.orderItems.map((t,c)=>e.jsx("tr",{className:"border-b border-text last:border-b-0 w-24 ",children:o.map(d=>e.jsx("td",{className:"border border-textColor text-center px-2 align-middle",children:d.label==="THUMBNAIL"?d.accessor(t):e.jsx(n,{children:d.accessor(t)})},d.label))},c))})]})})})}function G({orderDetails:r,isPrinting:a}){var l,o,t,c,d,m,u,h,f,v,N,g,b,I,i,x,p,j;const s=r==null?void 0:r.payment;return e.jsxs("div",{className:w("flex flex-col gap-1",{hidden:a}),children:[e.jsx(n,{variant:"uppercase",className:"font-bold",children:"payment:"}),e.jsxs(n,{variant:"uppercase",children:["status:"," ",(l=s==null?void 0:s.paymentInsert)!=null&&l.isTransactionDone?e.jsx(n,{component:"span",className:k.confirmed,children:"paid"}):e.jsx(n,{component:"span",className:k.denied,children:"unpaid"})]}),e.jsxs(n,{variant:"uppercase",children:["made at: ",M(s==null?void 0:s.modifiedAt)]}),e.jsxs(n,{variant:"uppercase",children:["payment method:"," ",(t=(o=s==null?void 0:s.paymentInsert)==null?void 0:o.paymentMethod)==null?void 0:t.replace("PAYMENT_METHOD_NAME_ENUM_","")]}),e.jsx(n,{variant:"uppercase",children:["amount: ",((c=s==null?void 0:s.paymentInsert)==null?void 0:c.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"||((d=s==null?void 0:s.paymentInsert)==null?void 0:d.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"?e.jsx("span",{children:(u=(m=s==null?void 0:s.paymentInsert)==null?void 0:m.transactionAmountPaymentCurrency)==null?void 0:u.value}):e.jsx("span",{children:(f=(h=s==null?void 0:s.paymentInsert)==null?void 0:h.transactionAmount)==null?void 0:f.value})]}),((v=s==null?void 0:s.paymentInsert)==null?void 0:v.payer)&&e.jsx(n,{variant:"uppercase",className:"flex items-center gap-2",children:["payer: ",e.jsx(T,{text:((N=s==null?void 0:s.paymentInsert)==null?void 0:N.payer)||""})]}),((g=s==null?void 0:s.paymentInsert)==null?void 0:g.payee)&&e.jsx(n,{variant:"uppercase",className:"flex items-center gap-2",children:["payee: ",e.jsx(T,{text:((b=s==null?void 0:s.paymentInsert)==null?void 0:b.payee)||""})]}),((I=s==null?void 0:s.paymentInsert)==null?void 0:I.isTransactionDone)&&e.jsx(n,{variant:"uppercase",className:"flex items-center gap-2",children:((i=s.paymentInsert)==null?void 0:i.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD_TEST"||((x=s.paymentInsert)==null?void 0:x.paymentMethod)==="PAYMENT_METHOD_NAME_ENUM_CARD"?["client secret: ",e.jsx(T,{text:((p=s==null?void 0:s.paymentInsert)==null?void 0:p.clientSecret)||"",cutText:!0})]:["txid: ",e.jsx(T,{text:((j=s==null?void 0:s.paymentInsert)==null?void 0:j.transactionId)||"",cutText:!0})]})]})}function W({orderDetails:r}){var s,l;const a=(s=r==null?void 0:r.promoCode)==null?void 0:s.promoCodeInsert;return a&&e.jsxs("div",{className:"flex flex-row lg:flex-col gap-2",children:[e.jsx(n,{variant:"uppercase",children:`promo applied: ${a.code} - ${(l=a.discount)==null?void 0:l.value}%`}),a.freeShipping&&e.jsx(n,{variant:"uppercase",children:"free ship"}),a.voucher&&e.jsx(n,{variant:"uppercase",children:"voucher"})]})}function A({shipping:r}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(n,{variant:"uppercase",children:`street adress: ${r==null?void 0:r.addressLineOne}`}),e.jsx(n,{variant:"uppercase",children:`city: ${r==null?void 0:r.city}`}),(r==null?void 0:r.state)&&e.jsx(n,{variant:"uppercase",children:`state: ${r==null?void 0:r.state}`}),e.jsx(n,{variant:"uppercase",children:`country: ${r==null?void 0:r.country}`}),e.jsx(n,{variant:"uppercase",children:`postal code: ${r==null?void 0:r.postalCode}`})]})}function O({trackingNumber:r,isPrinting:a,handleTrackingNumberChange:s,saveTrackingNumber:l}){return e.jsx("div",{className:w("w-full lg:w-1/4 border border-textColor",{hidden:a}),children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(L,{name:"trackingNumber",placeholder:"tracking number",className:"placeholder:uppercase border border-b border-transparent h-9",value:r,onChange:s}),e.jsx(C,{onClick:l,variant:"main",size:"lg",children:"+"})]})})}function Z({isEdit:r,isPrinting:a,trackingNumber:s,orderStatus:l,orderDetails:o,toggleTrackNumber:t,handleTrackingNumberChange:c,saveTrackingNumber:d}){var m,u;return e.jsx(e.Fragment,{children:((m=o==null?void 0:o.shipment)==null?void 0:m.trackingCode)&&e.jsx("div",{children:r&&!a?e.jsx(O,{isPrinting:a,trackingNumber:s,handleTrackingNumberChange:c,saveTrackingNumber:d}):!a&&e.jsx(n,{variant:"uppercase",children:[`tracking number: ${(u=o==null?void 0:o.shipment)==null?void 0:u.trackingCode} `,l==="SHIPPED"&&e.jsx(C,{onClick:t,children:e.jsx(R,{})})]})})})}function K({orderDetails:r,isPrinting:a,orderStatus:s,isEdit:l,trackingNumber:o,toggleTrackNumber:t,handleTrackingNumberChange:c,saveTrackingNumber:d}){var N,g,b,I;const{dictionary:m}=P(),[u,h]=E.useState(!1),f=(N=r==null?void 0:r.shipping)==null?void 0:N.addressInsert,v=(g=r==null?void 0:r.billing)==null?void 0:g.addressInsert;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-4 print:hidden",children:[e.jsx(C,{onClick:()=>h(!1),variant:u?"simpleReverse":"main",className:"p-1",children:"Shipping"}),e.jsx(C,{onClick:()=>h(!0),variant:u?"main":"simpleReverse",className:"p-1",children:"Billing"})]}),u?v&&e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(n,{variant:"uppercase",className:"font-bold",children:"billing address:"}),e.jsx(A,{shipping:v})]}):f&&e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx(n,{variant:"uppercase",className:"font-bold",children:"shipping:"}),e.jsx(A,{shipping:f}),e.jsx(n,{variant:"uppercase",children:`cost: ${(I=(b=r==null?void 0:r.shipment)==null?void 0:b.cost)==null?void 0:I.value} ${m==null?void 0:m.baseCurrency}`}),e.jsx(Z,{isEdit:l,isPrinting:a,trackingNumber:o,orderStatus:s||"",orderDetails:r,toggleTrackNumber:t,handleTrackingNumberChange:c,saveTrackingNumber:d})]})]})}const Q=r=>{const{dictionary:a}=P(),s=y(i=>i.showMessage),[l,o]=E.useState({orderDetails:void 0,dictionary:void 0,orderStatus:void 0,isLoading:!1}),[t,c]=E.useState(!1),[d,m]=E.useState(!1),[u,h]=E.useState("");async function f(){o(i=>({...i,isLoading:!0}));try{const i=await S.GetOrderByUUID({orderUuid:r});o(x=>{var p,j;return{...x,orderDetails:i.order,dictionary:a,orderStatus:H(a,(j=(p=i.order)==null?void 0:p.order)==null?void 0:j.orderStatusId)}})}catch(i){const x=i instanceof Error?i.message:"Error fetching order details";s(x,"error")}finally{o(i=>({...i,isLoading:!1}))}}E.useEffect(()=>{f()},[r,a]),E.useEffect(()=>{const i=()=>c(!0),x=()=>c(!1);return window.addEventListener("beforeprint",i),window.addEventListener("afterprint",x),()=>{window.removeEventListener("beforeprint",i),window.removeEventListener("afterprint",x)}},[]);const v=()=>{var i,x;!t&&l.orderStatus==="SHIPPED"&&(m(!d),d&&h(((x=(i=l.orderDetails)==null?void 0:i.shipment)==null?void 0:x.trackingCode)||""))};function N(i){h(i.target.value)}const g=async()=>{var i,x;if(!u.trim()){m(!1);return}try{await S.SetTrackingNumber({orderUuid:(x=(i=l.orderDetails)==null?void 0:i.order)==null?void 0:x.uuid,trackingCode:u}),f(),m(!1)}catch(p){const j=p instanceof Error?p.message:"Failed to save tracking number";s(j,"error")}};async function b(){var i,x;try{await S.DeliveredOrder({orderUuid:(x=(i=l.orderDetails)==null?void 0:i.order)==null?void 0:x.uuid}),f()}catch(p){const j=p instanceof Error?p.message:"Failed to mark as delivered";s(j,"error")}}async function I(){var i,x;try{await S.RefundOrder({orderUuid:(x=(i=l.orderDetails)==null?void 0:i.order)==null?void 0:x.uuid}),f()}catch(p){const j=p instanceof Error?p.message:"Failed to refund order";s(j,"error")}}return{...l,isPrinting:t,isEdit:d,trackingNumber:u,saveTrackingNumber:g,toggleTrackNumber:v,handleTrackingNumberChange:N,markAsDelivered:b,refundOrder:I}};function ee(){var v,N,g,b;const{uuid:r}=z(),{orderDetails:a,dictionary:s,orderStatus:l,isPrinting:o,isEdit:t,trackingNumber:c,toggleTrackNumber:d,handleTrackingNumberChange:m,saveTrackingNumber:u,markAsDelivered:h,refundOrder:f}=Q(r||"");return e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[o&&e.jsx("div",{className:"self-start h-10 pt-2",children:e.jsx(B,{})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Y,{orderDetails:a,orderStatus:l,isPrinting:!0}),e.jsx(q,{orderDetails:a,isPrinting:o}),e.jsx(n,{variant:"uppercase",className:"font-bold self-end",children:`Total: ${(N=(v=a==null?void 0:a.order)==null?void 0:v.totalPrice)==null?void 0:N.value} ${s==null?void 0:s.baseCurrency}`}),e.jsx("div",{className:"block print:hidden",children:e.jsx(W,{orderDetails:a})}),e.jsxs("div",{className:"flex gap-10 lg:gap-0 lg:flex-row flex-col lg:items-end lg:justify-between w-full",children:[e.jsx(G,{orderDetails:a,isPrinting:o}),e.jsx(K,{orderDetails:a,isPrinting:o,orderStatus:l,isEdit:t,trackingNumber:c,toggleTrackNumber:d,handleTrackingNumberChange:m,saveTrackingNumber:u}),e.jsx(F,{buyer:(g=a==null?void 0:a.buyer)==null?void 0:g.buyerInsert,isPrinting:o})]})]}),l==="CONFIRMED"&&!((b=a==null?void 0:a.shipment)!=null&&b.trackingCode)&&e.jsx(O,{isPrinting:o,trackingNumber:c,handleTrackingNumberChange:m,saveTrackingNumber:u}),l==="SHIPPED"&&e.jsx(C,{variant:"main",size:"lg",className:"block print:hidden",onClick:h,children:"mark as delivered"}),l==="CONFIRMED"||l==="DELIVERED"&&e.jsx(C,{variant:"main",size:"lg",className:"block print:hidden",onClick:f,children:"refund order"}),e.jsx(n,{variant:"uppercase",className:"font-bold hidden print:block",children:"If you have any questions, please send an email to customercare@grbpwr.com"})]})}export{ee as OrderDetails};
